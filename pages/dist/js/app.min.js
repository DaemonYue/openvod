/*! openvod | emma | ISC */
"use strict";!function(){angular.module("app.controllers",[]).controller("indexController",["$scope",function(a){var b=this;b.init=function(){this.maskUrl=""}}]).controller("loginController",["$scope","$http","$filter","$state","md5","util",function(a,b,c,d,e,f){var g=this;g.init=function(){},g.login=function(){g.loading=!0;var a=JSON.stringify({action:"GetToken",projectName:g.projectName,username:g.userName,password:e.createHash(g.password)});b({method:"POST",url:f.getApiUrl("logon","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.setParams("userName",g.userName),f.setParams("projectName",g.projectName),f.setParams("token",b.token),f.setParams("projectDes",b.ProjectNameCN),g.getEditLangs()):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loading=!1})},g.getEditLangs=function(){b({method:"GET",url:f.getApiUrl("","editLangs.json","local")}).then(function(a){f.setParams("editLangs",a.data.editLangs),d.go("app")},function(a){})}}]).controller("appController",["$http","$scope","$state","$stateParams","util",function(a,b,c,d,e){var f=this;f.init=function(){e.getParams("projectDes")?this.projectDes=e.getParams("projectDes"):(alert("访问超时，请重新登录"),c.go("login")),"app"!==c.current.name?f.appPhase=2:f.appPhase=1,f.appFramePhase=1,f.maskUrl="",f.maskParams={},f.loading=!0,a({method:"GET",url:e.getApiUrl("","apps.json","local")}).then(function(a,c,e,g){b.appList=a.data.apps,d.appId&&f.setFocusApp(d.appId)},function(a,b,c,d){}).finally(function(a){f.loading=!1})},f.feedback=function(){b.app.showHideMask(!0,"pages/feedback.html")},f.setFocusApp=function(a){for(var c=b.appList,d=0;d<c.length;d++)if(c[d].id==a){f.activeAppName=c[d].name,f.activeAppIcon=c[d].icon,f.activeAppBgColor=c[d].bgColor,f.activeAppThemeColor=c[d].themeColor;break}},f.switchApp=function(a){switch(f.appPhase=2,f.appFramePhase=1,f.setFocusApp(a),a){case 1:"app.hotelRoom.room"!==c.current.name&&c.go("app.hotelRoom",{appId:a});break;case 2:c.go("app.hotelOrderList",{appId:a});break;case 3:"app.shop.goods.goodsList"!==c.current.name&&c.go("app.shop",{appId:a});break;case 4:c.go("app.shopOrderList",{appId:a});break;case 5:c.includes("app.tvAdmin")||c.go("app.tvAdmin",{appId:a});break;case 6:c.go("app.terminal",{appId:a});break;case 7:c.go("app.wxUser",{appId:a});break;case 8:c.includes("app.projectConfig")||c.go("app.projectConfig",{appId:a})}},f.showDesktop=function(){f.appPhase=1,setTimeout(function(){f.appFramePhase=1},530)},f.focusLauncher=function(){f.appFramePhase=2},f.focusApp=function(){f.appFramePhase=1},f.logout=function(a){e.setParams("token",""),c.go("login")},f.showHideMask=function(a,c){a?(b.app.maskUrl=c,b.app.showMaskClass=!0):(b.app.maskUrl="",b.app.showMaskClass=!1)}}]).controller("feedbackController",["$scope",function(a){var b=this;b.init=function(){},b.exit=function(){a.app.showHideMask(!1)}}]).controller("terminalController",["$scope","$state","$translate","$http","$stateParams","$filter","NgTableParams","util",function(a,b,c,d,e,f,g,h){console.log("terminalController");var i=this;i.init=function(){i.form={},i.defaultLangCode=h.getDefaultLangCode(),i.langStyle=h.langStyle(),i.multiLang=h.getParams("editLangs"),i.searchHotelList()},i.searchHotelList=function(){var a={action:"getHotelList",token:h.getParams("token"),lang:i.langStyle};a=JSON.stringify(a),d({method:f("ajaxMethod")(),url:h.getApiUrl("hotelroom","shopList","server"),data:a}).then(function(a,c,d,e){"200"==a.data.rescode?i.hotelList=a.data.data:"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("列表获取失败， "+a.data.errInfo)},function(a,b,c,d){alert("获取失败， "+a.data.errInfo)}).finally(function(a){i.loading=!1})},i.getDevList=function(){i.noData=!1,i.loading=!0,i.tableParams=new g({page:1,count:15,url:""},{counts:[],getData:function(a){var b={action:"getDevList",token:h.getParams("token"),lang:i.langStyle,Online:i.form.Online,HotelID:i.form.HotelID,RoomID:i.form.RoomID},c=a.url();return b.per_page=c.count-0,b.page=c.page-0,b=JSON.stringify(b),d({method:f("ajaxMethod")(),url:h.getApiUrl("devinfo","shopList","server"),data:b}).then(function(b,c,d,e){return"200"==b.data.rescode?(0==b.data.total&&(i.noData=!0),a.total(b.data.total),b.data.devlist):void("401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(b.rescode+" "+b.errInfo))},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){i.loading=!1})}})},i.getDevNum=function(a,b){i.form.HotelName=i.hotelList[b].Name[i.defaultLangCode],i.form.HotelID=a,i.hotelListIndex=b,i.getDevList();var c={action:"getDevNum",token:h.getParams("token"),lang:i.langStyle,HotelID:i.form.HotelID};c=JSON.stringify(c),d({method:f("ajaxMethod")(),url:h.getApiUrl("devinfo","","server"),data:c}).then(function(a,b,c,d){"200"==a.data.rescode?(i.form.total=a.data.total,i.form.online=a.data.online):"401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.rescode+" "+a.errInfo)},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.delTerm=function(a){var b=confirm("确认删除？");if(b){var c={action:"delDev",token:h.getParams("token"),lang:i.langStyle,ID:a};c=JSON.stringify(c),d({method:f("ajaxMethod")(),url:h.getApiUrl("devinfo","","server"),data:c}).then(function(a,b,c,d){"200"==a.data.rescode?(i.getDevList(),i.getDevNum(i.form.HotelID,i.hotelListIndex)):"401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")})}},i.validDev=function(a,c){var g={action:"validDev",token:h.getParams("token"),lang:i.langStyle,ID:[a]};c?g.status=0:g.status=1,g=JSON.stringify(g),d({method:f("ajaxMethod")(),url:h.getApiUrl("devinfo","","server"),data:g}).then(function(a,c,d,f){"200"==a.data.rescode?(alert("操作成功"),b.reload(b.current.name,e,!0)):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("操作失败， "+a.data.errInfo)},function(a,b,c,d){alert("操作失败， "+a.data.errInfo)}).finally(function(a){})},i.addDev=function(){a.app.maskParams={HotelID:i.form.HotelID},a.app.showHideMask(!0,"pages/addDev.html")}}]).controller("addDevController",["$scope","$state","$http","$stateParams","$translate","$filter","util",function(a,b,c,d,e,f,g){console.log("addDevController");var h=this;h.init=function(){h.langStyle=g.langStyle(),h.multiLang=g.getParams("editLangs"),h.maskParams=a.app.maskParams,h.form={}},h.cancel=function(){a.app.showHideMask(!1)},h.addDev=function(){h.saving=!0;var a={action:"addDev",token:g.getParams("token"),lang:h.langStyle,detail:{HotelID:h.maskParams.HotelID,RoomID:h.form.RoomID,TermMac:h.form.TermMac}};a=JSON.stringify(a),c({method:f("ajaxMethod")(),url:g.getApiUrl("devinfo","shopList","server"),data:a}).then(function(a,c,e,f){"200"==a.data.rescode?(alert("终端添加成功"),h.cancel(),b.go(b.current,d,{reload:!0})):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("列表获取失败， "+a.data.errInfo)},function(a,b,c,d){alert("获取失败， "+a.data.errInfo)}).finally(function(a){h.saving=!1})}}]).controller("wxUserController",["$scope","$state","$translate","$http","$stateParams","$filter","NgTableParams","util",function(a,b,c,d,e,f,g,h){console.log("wxUserController");var i=this;i.init=function(){i.langStyle=h.langStyle(),i.multiLang=h.getParams("editLangs"),i.getWxUserInfo()},i.getWxUserInfo=function(){i.noData=!1,i.loading=!0,i.tableParams=new g({page:1,count:15,url:""},{counts:[],getData:function(a){var b={action:"getWxUserInfo",token:h.getParams("token"),lang:i.langStyle},c=a.url();return b.per_page=c.count-0,b.page=c.page-0,b=JSON.stringify(b),d({method:f("ajaxMethod")(),url:h.getApiUrl("devinfo","shopList","server"),data:b}).then(function(b,c,d,e){return"200"==b.data.rescode?(0==b.data.total&&(i.noData=!0),a.total(b.data.total),b.data.userinfo):void("401"==msg.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(b.rescode+" "+b.errInfo))},function(a,b,c,d){alert(response.status+" 服务器出错")}).finally(function(a){i.loading=!1})}})}}]).controller("shopController",["$scope","$state","$translate","$http","$stateParams","$filter","util",function(a,b,c,d,e,f,g){console.log("shopController");var h=this;h.init=function(){h.langStyle=g.langStyle(),h.multiLang=g.getParams("editLangs"),h.loading=!1,h.noData=!1,h.searchShopList(),a.ShopID=e.ShopID},h.searchShopList=function(){h.loading=!0;var a={action:"getMgtHotelShopInfo",token:g.getParams("token"),lang:h.langStyle};a=JSON.stringify(a),d({method:f("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,f){if("200"==a.data.rescode){if(0==a.data.data.shopList.length)return void(h.noData=!0);if(h.shopList=a.data.data.shopList,h.shopFirst=h.shopList[0],e.ShopID)for(var g=0;g<h.shopList.length;g++)if(e.ShopID==h.shopList[g].ShopID){h.shopFirst=h.shopList[g];break}h.goTo(h.shopFirst.ShopID,h.shopFirst.HotelID,h.shopFirst.ShopName,h.shopFirst.HotelName,h.shopFirst.ShopType)}else"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败， "+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){h.loading=!1})},h.shopAdd=function(){a.app.showHideMask(!0,"pages/shopAdd.html")},h.goTo=function(c,d,f,g,h){a.app.maskParams.ShopName=f,a.app.maskParams.HotelName=g,a.app.maskParams.ShopType=h,c!=e.ShopID&&(a.ShopID=c,b.go("app.shop.goods",{ShopID:c,HotelID:d}))}}]).controller("shopAddController",["$scope","$state","$http","$stateParams","$translate","$filter","util",function(a,b,c,d,e,f,g){console.log("shopAddController");var h=this;h.init=function(){h.langStyle=g.langStyle(),h.multiLang=g.getParams("editLangs"),h.saving=!1,h.searchHotelList(),h.form={},h.form.shopName={},h.saving=!1,h.loading=!1},h.cancel=function(){a.app.showHideMask(!1)},h.searchHotelList=function(){h.loading=!0;var a={action:"getHotelList",token:g.getParams("token"),lang:h.langStyle};a=JSON.stringify(a),c({method:f("ajaxMethod")(),url:g.getApiUrl("hotelroom","shopList","server"),data:a}).then(function(a,c,d,e){if("200"==a.data.rescode){if(0==a.data.data.length)return void(h.noData=!0);h.hotelList=a.data.data}else"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("列表获取失败， "+a.data.errInfo)},function(a,b,c,d){alert("获取失败， "+a.data.errInfo)}).finally(function(a){h.loading=!1})},h.saveForm=function(){if(!h.form.HotelID)return void alert("请选择门店");var a={HotelID:h.form.HotelID-0,ShopName:h.form.shopName,ShopType:h.ShopType},d={action:"addMgtHotelShop",token:g.getParams("token"),lang:h.langStyle,shopList:[a]};d=JSON.stringify(d),h.saving=!0,c({method:f("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("添加成功"),b.reload()):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败， "+a.data.errInfo)},function(a,b,c,d){alert("添加失败， "+a.data.errInfo)}).finally(function(a){h.saving=!1})}}]).controller("goodsController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("goodsController");var g=this;g.init=function(){g.maskParams=a.app.maskParams,g.stateParams=d,g.langStyle=f.langStyle(),g.multiLang=f.getParams("editLangs"),g.ShopGoodsCategoryID=d.ShopGoodsCategoryID,g.noData=!1,g.loading=!1,g.getGoodsCategory()},g.categoryAdd=function(){a.app.maskParams={ShopID:g.stateParams.ShopID-0},a.app.showHideMask(!0,"pages/categoryAdd.html")},g.shopEdit=function(){a.app.maskParams={ShopID:d.ShopID,ShopName:g.maskParams.ShopName,HotelName:g.maskParams.HotelName,HotelID:d.HotelID,ShopType:g.maskParams.ShopType},a.app.showHideMask(!0,"pages/shopEdit.html")},g.getGoodsCategory=function(){g.loading=!0;var a={action:"getMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,shopId:d.ShopID};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,e,f){if("200"==a.data.rescode){if(0==a.data.data.categoryList.length&&(g.noData=!0),g.categoryList=a.data.data.categoryList,g.gotoShopCate={id:"all",name:{"en-US":"All","zh-CN":"全部商城"}},d.ShopGoodsCategoryID)for(var h=0;h<g.categoryList.length;h++)if(d.ShopGoodsCategoryID==g.categoryList[h].id){g.gotoShopCate=g.categoryList[h];break}g.goTo(g.gotoShopCate.id,g.gotoShopCate.name)}else"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败， "+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.JSONstringfy=function(a){return JSON.stringify(a)},g.goTo=function(c,d){g.ShopGoodsCategoryID=c,a.app.maskParams.name=d,b.go("app.shop.goods.goodsList",{ShopGoodsCategoryID:c})}}]).controller("goodsAddController",["$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g){function h(a){this.initImgList=a,this.data=[],this.maxId=0}console.log("goodsAddController");var i=this;i.init=function(){i.shopId=a.app.maskParams.shopId,i.shopGoodsCategoryId=a.app.maskParams.shopGoodsCategoryId,i.imgs=new h([]),i.editLangs=f.getParams("editLangs"),i.name={},i.intro={}},i.cancel=function(){console.log("cancel"),a.app.showHideMask(!1)},i.addGoods=function(){if(0==i.imgs.data.length)return void alert("请上传图片");if(i.imgs.data.some(function(a,b,c){return a.progress<100&&a.progress!==-1}))return void alert("请等待图片上传完成");for(var a=[],d=i.imgs.data,e=0;e<d.length;e++)a[e]={},a[e].ImageURL=d[e].src,a[e].Seq=e,a[e].ImageSize=Number(d[e].fileSize);var g=JSON.stringify({action:"addMgtProductDetail",token:f.getParams("token"),lang:f.langStyle(),product:{ShopID:i.shopId,categoryId:i.shopGoodsCategoryId,name:i.name,invetory:i.invetory,price:100*i.price,intro:i.intro,imgSrc:a}});i.saving=!0,c({method:"POST",url:f.getApiUrl("shopinfo","","server"),data:g}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("添加成功"),b.reload()):alert("添加失败，错误编码："+a.data.rescode+"，"+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b){var c=a[b],d=g.uploadUrl,e=new XMLHttpRequest,h=this.add(e,c.name,c.size,e);f.uploadFileToUrl(e,c,d,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);i.imgs.update(h,a,b.total-b.loaded,b.total),console.log(a)}})},function(b){var c=JSON.parse(b.responseText);console&&console.log(c),a.$apply(function(){i.imgs.setSrcSizeByXhr(b,c.upload_path,c.size)})},function(b){a.$apply(function(){i.imgs.update(h,-1,"","")}),console.log("failure"),b.abort()})}}}]).controller("goodsEditController",["$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g){function h(a){this.initImgList=a,this.data=[],this.maxId=0}console.log("goodsEditController");var i=this;i.init=function(){i.productId=a.app.maskParams.productId,i.editLangs=f.getParams("editLangs"),i.name={},i.intro={},i.getGoodsInfo()},i.getGoodsInfo=function(){i.loading=!0;var a=JSON.stringify({action:"getMgtProductDetail",token:f.getParams("token"),lang:f.langStyle(),productId:i.productId});c({method:"POST",url:f.getApiUrl("shopinfo","","server"),data:a}).then(function(a,b,c,d){if("200"==a.data.rescode){var a=a.data.data;i.name=a.product.name,i.invetory=a.product.invetory-0,i.price=(a.product.price-0)/100,i.intro=a.product.intro,i.imgs=new h(a.product.imgSrc),i.imgs.initImgs()}else alert("读取商品失败"+a.data.rescode+"，"+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){i.loading=!1})},i.cancel=function(){console.log("cancel"),a.app.showHideMask(!1)},i.editGoods=function(){if(0==i.imgs.data.length)return void alert("请上传图片");if(i.imgs.data.some(function(a,b,c){return a.progress<100&&a.progress!==-1}))return void alert("请等待图片上传完成");for(var a=[],d=i.imgs.data,e=0;e<d.length;e++)a[e]={},a[e].ImageURL=d[e].src,a[e].Seq=e,a[e].ImageSize=Number(d[e].fileSize);var g=JSON.stringify({action:"editMgtProductDetail",token:f.getParams("token"),lang:f.langStyle(),product:{productID:i.productId,name:i.name,invetory:i.invetory,price:100*i.price,intro:i.intro,imgSrc:a}});console.log(g),i.saving=!0,c({method:"POST",url:f.getApiUrl("shopinfo","","server"),data:g}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("修改成功"),b.reload("app.shop.goods.goodsList"),i.cancel()):alert("修改失败，错误编码："+a.data.rescode+"，"+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b){var c=a[b],d=g.uploadUrl,e=new XMLHttpRequest,h=this.add(e,c.name,c.size,e);f.uploadFileToUrl(e,c,d,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);i.imgs.update(h,a,b.total-b.loaded,b.total),console.log(a)}})},function(b){var c=JSON.parse(b.responseText);console&&console.log(c),a.$apply(function(){i.imgs.setSrcSizeByXhr(b,c.upload_path,c.size)})},function(b){a.$apply(function(){i.imgs.update(h,-1,"","")}),console.log("failure"),b.abort()})}}}]).controller("shopEditController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("shopEditController");var g=this;g.init=function(){g.maskParams=a.app.maskParams,g.langStyle=f.langStyle(),g.multiLang=f.getParams("editLangs"),g.noData=!1,g.loading=!1,g.saving=!1,g.form={},g.form.shopName={},g.shopInfo=g.maskParams.ShopName,g.ShopType=g.maskParams.ShopType},g.cancel=function(){console.log("cancel"),a.app.showHideMask(!1)},g.saveForm=function(){g.saving=!0;var a={action:"editMgtHotelShop",token:f.getParams("token"),lang:g.langStyle,shop:{ShopID:g.maskParams.ShopID,ShopName:g.shopInfo,ShopType:g.ShopType}};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("保存成功"),b.reload()):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("保存失败， "+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){g.saving=!1})},g.deleteShop=function(){var a=confirm("确认删除？");if(a){g.saving=!0;var d=({HotelID:g.form.HotelID-0,ShopName:g.form.shopName,ShopType:g.ShopType},{action:"deleteMgtHotelShop",token:f.getParams("token"),lang:g.langStyle,shop:{ShopID:g.maskParams.ShopID-0}});d=JSON.stringify(d),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("删除成功"),b.reload()):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败， "+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}}]).controller("categoryAddController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("categoryAddController"),console.log(d),console.log(a.app.maskParams);var g=this;g.init=function(){g.langStyle=f.langStyle(),g.maskParams=a.app.maskParams,g.ShopName=g.maskParams.ShopGoodsCategoryName,g.multiLang=f.getParams("editLangs"),g.saving=!1,g.form={},g.form.shopName={}},g.cancel=function(){console.log("cancel"),a.app.showHideMask(!1)},g.saveForm=function(){g.saving=!0;var a={action:"addMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,ShopGoodsCategory:{ShopGoodsCategoryName:g.form.shopName,ShopID:g.maskParams.ShopID-0}};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("分类添加成功"),b.reload(),g.cancel()):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败， "+a.data.errInfo)},function(a,b,c,d){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}]).controller("categoryEditController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("categoryEditController");var g=this;g.init=function(){g.stateParams=d,g.maskParams=a.app.maskParams,g.langStyle=f.langStyle(),g.multiLang=f.getParams("editLangs"),g.form={},g.form.shopName={},g.categoryDetail=a.app.maskParams.name,g.saving=!1},g.cancel=function(){console.log("cancel"),a.app.showHideMask(!1)},g.saveForm=function(){g.saving=!0;var a={action:"editMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,ShopGoodsCategory:{ShopGoodsCategoryID:g.maskParams.id,ShopGoodsCategoryName:g.categoryDetail}};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){alert("分类修改成功"),b.reload()},function(a,b,c,d){}).finally(function(a){g.saving=!1})}}]).controller("goodsListController",["$scope","$state","$http","$stateParams","$filter","NgTableParams","util",function(a,b,c,d,e,f,g){console.log("goodsListController");var h=this;h.init=function(){h.stateParams=d,h.langStyle=g.langStyle(),h.multiLang=g.getParams("editLangs"),h.getGoodsCategory(),h.getProductList(h.stateParams.ShopGoodsCategoryID),h.saving=!1},h.categoryEdit=function(){a.app.maskParams.id=h.stateParams.ShopGoodsCategoryID,a.app.showHideMask(!0,"pages/categoryEdit.html")},h.categoryDelete=function(){var a=confirm("确认删除？");if(a){h.saving=!0;var d={action:"deleteMgtProductCategory",token:g.getParams("token"),lang:h.langStyle,ShopGoodsCategoryID:h.stateParams.ShopGoodsCategoryID-0};d=JSON.stringify(d),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){"200"==a.data.rescode?(alert("分类删除成功"),b.reload()):"401"==a.data.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败， "+a.data.errInfo)},function(a,b,c,d){alert("添加失败， "+a.data.errInfo)})}},h.goodsAdd=function(){a.app.maskParams={shopId:h.stateParams.ShopID,shopGoodsCategoryId:h.stateParams.ShopGoodsCategoryID},a.app.showHideMask(!0,"pages/goodsAdd.html")},h.goodsEdit=function(b){a.app.maskParams={productId:b},a.app.showHideMask(!0,"pages/goodsEdit.html")},h.getGoodsCategory=function(){var a={action:"getMgtProductCategory",token:g.getParams("token"),lang:h.langStyle,shopId:d.ShopID-0};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,b,c,d){h.categoryList=a.data.data.categoryList},function(a,b,c,d){})},h.getProductList=function(a){var b={action:"getMgtShopProductList",token:g.getParams("token"),lang:h.langStyle,ShopID:h.stateParams.ShopID-0,count:1e3,page:1};"all"!=a&&(b.ShopGoodsCategoryID=h.stateParams.ShopGoodsCategoryID-0,b.action="getMgtProductList"),b=JSON.stringify(b),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:b}).then(function(a,b,c,d){var a=a.data.data.productList;h.goodsList=a},function(a,b,c,d){})},h.checkGoodsCategory=function(a,b){for(var c=0;c<b.length;c++)if(a==b[c].ShopGoodsCategoryID)return!0},h.changeGoodsCategory=function(a,d,f,i){h.categoryObj={},h.categoryObj[a]=[],console.log("categoryList "+i);for(var j=0;j<i.length;j++)h.categoryObj[a].push(i[j].ShopGoodsCategoryID);var k=h.categoryObj[a].indexOf(d);console.log(k),k<0?h.categoryObj[a].push(d):h.categoryObj[a].splice(k,1),console.log(h.categoryObj[a]);var l={action:"editMgtProductPCategory",token:g.getParams("token"),lang:h.langStyle,product:{productID:a-0,categoryList:h.categoryObj[a]}};l=JSON.stringify(l),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:l}).then(function(a,c,d,e){console.log(a),alert("修改分类成功"),b.reload("app.shop.goods.goodsList")},function(a,b,c,d){})},h.changeGoodsStatus=function(a,d,f){console.log("productId:"+a+" status:"+d+" value:"+f),d=1==d?1:0;var i={action:"editMgtProductStatus",token:g.getParams("token"),lang:h.langStyle,product:{productID:a-0,Status:d}};i=JSON.stringify(i),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:i}).then(function(a,c,d,e){alert("修改成功"),b.reload("app.shop.goods.goodsList")},function(a,b,c,d){})}}]).controller("hotelRoomController",["$scope","$http","$stateParams","$state","util",function(a,b,c,d,e){var f,g=this;g.init=function(){f=e.langStyle(),g.defaultLangCode=e.getDefaultLangCode(),g.queryHotelList()},g.queryHotelList=function(){var a=JSON.stringify({action:"getHotelList",token:e.getParams("token"),lang:f});b({method:"POST",url:e.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(g.hotels=b.data,0==g.hotels.length?g.noData=!0:c.hotelId?d.go("app.hotelRoom.room",{hotelId:c.hotelId}):d.go("app.hotelRoom.room",{hotelId:g.hotels[0].ID})):"401"==b.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){g.loadingHotelInfo=!1})}}]).controller("roomController",["$scope","$http","$stateParams","$translate","$location","util","NgTableParams",function(a,b,c,d,e,f,g){var h,i=this;i.init=function(){h=f.langStyle(),i.defaultLangCode=f.getDefaultLangCode(),i.hotelId=c.hotelId,i.getHotelInfo()},i.getHotelInfo=function(){i.loadingHotelInfo=!0;var a=JSON.stringify({action:"getHotel",token:f.getParams("token"),lang:h,HotelID:Number(i.hotelId)});b({method:"POST",url:f.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(i.hotel={},i.hotel.Imgs=b.data.Gallery,i.hotel.Tags=b.data.Features,i.hotel.Name=b.data.Name,i.hotel.Address=b.data.Address,i.hotel.Description=b.data.Description,i.hotel.LocationX=b.data.LocationX,i.hotel.LocationY=b.data.LocationY,i.hotel.LogoImg=b.data.LogoURL,i.hotel.CityName=b.data.CityName,i.hotel.AdminPhoneNum=b.data.AdminPhoneNum):"401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("读取信息失败，"+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loadingHotelInfo=!1})},i.search=function(){var a="";i.searchName&&(a=i.searchName);var c=JSON.stringify({action:"getAllRoomInfo",token:f.getParams("token"),lang:h,HotelID:Number(i.hotelId),page:1,per_page:1e4,bookStartDate:f.getToday(),bookEndDate:f.getTomorrow()});return i.loading=!0,i.noData=!1,b({method:"POST",url:f.getApiUrl("room","","server"),data:c}).then(function(a){var b=a.data;"200"==b.rescode?i.rooms=b.roomsInfo:"401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("读取数据出错，"+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(){i.loading=!1})},i.RAChanged=function(a){var c=i.rooms[a];if(null==c.PriceMonday||null==c.PriceTuesday||null==c.PriceWednesday||null==c.PriceThursday||null==c.PriceFriday||null==c.PriceSaturday||null==c.PriceSunday||null==c.AvailableNum)return c.RoomAvailable=0,alert("未设置房间价格或数量，请设好后重试"),!1;var d=c.ID,g=c.RoomAvailable,j=JSON.stringify({action:"setRoomAvailable",token:f.getParams("token"),lang:h,roomID:d,RoomAvailable:1==g?1:0});i.loading=!0,b({method:"POST",url:f.getApiUrl("room","","server"),data:j}).then(function(a){var b=a.data;"200"==b.rescode||("401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("操作失败，"+b.errInfo))},function(a){alert(a.status+" 服务器出错")}).finally(function(){i.loading=!1})},i.hotelEdit=function(){a.app.maskParams={hotelId:i.hotelId,hotelInfo:i.hotel},a.app.showHideMask(!0,"pages/hotelEdit.html")},i.roomAdd=function(){a.app.maskParams={hotelId:i.hotelId},a.app.showHideMask(!0,"pages/roomAdd.html")},i.roomEdit=function(b){a.app.maskParams={hotelId:i.hotelId,roomId:b},a.app.showHideMask(!0,"pages/roomEdit.html")},i.roomEditPrice=function(b){a.app.maskParams={hotelId:i.hotelId,roomId:b},a.app.showHideMask(!0,"pages/roomEditPrice.html")},i.roomEditNum=function(b){a.app.maskParams={hotelId:i.hotelId,roomId:b},a.app.showHideMask(!0,"pages/roomEditNum.html")}}]).controller("hotelEditController",["$q","$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){function i(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}console.log("hotelEditController");var j=this;j.init=function(){j.defaultLangCode=g.getDefaultLangCode(),j.hotelId=b.app.maskParams.hotelId,b.app.maskParams.hotelInfo?(j.hotel=b.app.maskParams.hotelInfo,j.init2()):j.getHotelInfo().then(function(){j.init2()})},j.init2=function(){j.ifCheckedHotelTags=[],j.editLangs=g.getParams("editLangs"),j.initImgs1(),j.initImgs2(),j.getHotelTags()},j.getHotelInfo=function(){var b=a.defer();j.loading=!0;var c=JSON.stringify({action:"getHotel",token:g.getParams("token"),lang:g.langStyle(),HotelID:Number(j.hotelId)});return d({method:"POST",url:g.getApiUrl("hotelroom","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(j.hotel={},j.hotel.Imgs=c.data.Gallery,j.hotel.Tags=c.data.Features,j.hotel.Name=c.data.Name,j.hotel.Address=c.data.Address,j.hotel.Description=c.data.Description,j.hotel.LocationX=c.data.LocationX,j.hotel.LocationY=c.data.LocationY,j.hotel.LogoImg=c.data.LogoURL,j.hotel.CityName=c.data.CityName,j.hotel.AdminPhoneNum=c.data.AdminPhoneNum,j.hotel.TermMainPage=c.data.TermMainPage,b.resolve()):"401"==c.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):(alert("读取信息失败，"+c.errInfo),b.reject())},function(a){alert(a.status+" 服务器出错"),b.reject()}).finally(function(a){j.loading=!1}),b.promise},j.initImgs1=function(){j.imgs1=new i(j.hotel.Imgs),j.imgs1.initImgs()},j.initImgs2=function(){j.imgs2=new i([{ImageURL:j.hotel.LogoImg,ImageSize:0}],!0),j.imgs2.initImgs()},j.cancel=function(){b.app.showHideMask(!1)},j.save=function(){for(var a=[],b=0;b<j.imgs1.data.length;b++)a[b]={},a[b].Seq=b,a[b].ImageURL=j.imgs1.data[b].src,a[b].ImageSize=j.imgs1.data[b].fileSize;if(0==a.length)return void alert("请上传酒店图片");if(0==j.imgs2.data.length)return void alert("请上传酒店LOGO");for(var e=[],b=0;b<j.ifCheckedHotelTags.length;b++)j.ifCheckedHotelTags[b].checked&&e.push({ID:j.ifCheckedHotelTags[b].ID});j.saving=!0;var f=JSON.stringify({action:"editHotel",token:g.getParams("token"),lang:g.langStyle(),HotelID:Number(j.hotelId),data:{TermMainPage:j.hotel.TermMainPage,Name:j.hotel.Name,CityName:j.hotel.CityName,LocationX:j.hotel.LocationX,LocationY:j.hotel.LocationY,LogoURL:j.imgs2.data[0].src,Features:e,TelePhone:null,Address:j.hotel.Address,Description:j.hotel.Description,OfficePhone:null,AdminPhoneNum:j.hotel.AdminPhoneNum,Gallery:a}});d({method:"POST",url:g.getApiUrl("hotelroom","","server"),data:f}).then(function(a){var b=a.data;"200"==b.rescode?(alert("修改成功"),c.reload()):alert("保存失败"+b.err)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.saving=!1})},j.getHotelTags=function(){j.loading=!0;var a=JSON.stringify({action:"getHotelFeatureTag",token:g.getParams("token"),lang:g.langStyle()});d({method:"POST",url:g.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(console&&console.log(b.data),j.hotelTags=b.data,j.initIfCheckedHotelTags()):alert("读取酒店标签出错"+b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){
j.loading=!1})},j.initIfCheckedHotelTags=function(){for(var a=0;a<j.hotelTags.length;a++){j.ifCheckedHotelTags[a]={},j.ifCheckedHotelTags[a].checked=!1,j.ifCheckedHotelTags[a].ID=j.hotelTags[a].ID;for(var b=0;b<j.hotel.Tags.length;b++)if(j.hotel.Tags[b].ID==j.hotelTags[a].ID){j.ifCheckedHotelTags[a].checked=!0;break}}},j.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},i.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(a,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=b[a],f=h.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);g.uploadFileToUrl(i,e,f,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.update(j,b,a.total-a.loaded,a.total),console.log(b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeByXhr(a,d.upload_path,d.size),c.single&&c.deleteById(c.data[0].id)})},function(a){b.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),a.abort()})}}}]).controller("roomAddController",["$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.hotelId=a.app.maskParams.hotelId,i.room={},i.editLangs=f.getParams("editLangs"),i.defaultLangCode=f.getDefaultLangCode(),i.getRoomTags(),i.ifCheckedTags=[],i.imgs=new h([])},i.cancel=function(){a.app.showHideMask(!1)},i.getRoomTags=function(){i.loading=!0;var a=JSON.stringify({action:"getRoomTags",token:f.getParams("token"),lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){i.tags=b.tags;for(var c=0;c<i.tags.length;c++)i.ifCheckedTags[c]={},i.ifCheckedTags[c].ID=i.tags[c].ID,i.ifCheckedTags[c].checked=!1}else alert("读取标签失败"+b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.save=function(){for(var a=[],d=0;d<i.ifCheckedTags.length;d++)i.ifCheckedTags[d].checked&&a.push(i.ifCheckedTags[d].ID);for(var e=[],d=0;d<i.imgs.data.length;d++)e.push({Seq:d,ImageURL:i.imgs.data[d].src,ImageSize:i.imgs.data[d].fileSize});if(0==e.length)return void alert("请上传图片");i.saving=!0;var g=JSON.stringify({action:"addRoom",token:f.getParams("token"),lang:f.langStyle(),tags:a,IntroImgs:e,roomDetail:{HotelID:i.hotelId,Description:i.room.Description,RoomTypeName:i.room.RoomTypeName,Roomsummary:""}});c({method:"POST",url:f.getApiUrl("room","","server"),data:g}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload("app.hotelRoom.room"),i.cancel()):alert("添加失败"+c.rescode+" "+c.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.deleteById(c.data[0].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),b.abort()})}}}]).controller("roomEditController",["$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.alerts=[],i.init=function(){i.hotelId=a.app.maskParams.hotelId,i.roomId=a.app.maskParams.roomId,i.room={},i.editLangs=f.getParams("editLangs"),i.defaultLangCode=f.getDefaultLangCode(),i.ifCheckedTags=[],i.getRoomTags()},i.cancel=function(){a.app.showHideMask(!1)},i.addAlert=function(a,b,c){i.alerts.push({type:c,msg:a,reload:b})},i.closeAlert=function(a,c){i.alerts.splice(a,1),c&&b.reload()},i.getRoomTags=function(){i.loading=!0;var a=JSON.stringify({action:"getRoomTags",token:f.getParams("token"),lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){i.tags=b.tags;for(var c=0;c<i.tags.length;c++)i.ifCheckedTags[c]={},i.ifCheckedTags[c].ID=i.tags[c].ID,i.ifCheckedTags[c].checked=!1;i.getRoomInfo()}else i.addAlert("读取标签失败"+b.rescode+" "+b.errInfo,!1,"warning")},function(a){i.addAlert(a.status+" 服务器出错",!1,"warning")}).finally(function(a){i.loading=!1})},i.getRoomInfo=function(){i.loading=!0;var a=JSON.stringify({action:"getRoomInfoByID",token:f.getParams("token"),lang:f.langStyle(),roomID:i.roomId,bookStartDate:f.getToday(),bookEndDate:f.getTomorrow()});c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){i.room.RoomTypeName=b.RoomTypeName,i.room.Roomsummary=b.Roomsummary,i.room.Description=b.Description;for(var c=0;c<i.ifCheckedTags.length;c++)for(var d=0;d<b.tags.length;d++)i.ifCheckedTags[c].ID==b.tags[d].ID&&(i.ifCheckedTags[c].checked=!0);i.imgs=new h(b.imgs),i.imgs.initImgs()}else i.addAlert("读取客房信息失败"+b.rescode+" "+b.errInfo,!1,"warning")},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.deleteRoom=function(){if(confirm("确定要此客房吗？")){var a=JSON.stringify({action:"delRooms",token:f.getParams("token"),lang:f.langStyle(),roomList:[i.roomId]});c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?i.addAlert("删除成功",!0,"success"):i.addAlert("删除失败"+b.rescode+" "+b.errInfo,!1,"warning")},function(a){i.addAlert(a.status+" 服务器出错",!1,"warning")}).finally(function(a){i.saving=!1})}},i.save=function(){for(var a=[],d=0;d<i.ifCheckedTags.length;d++)i.ifCheckedTags[d].checked&&a.push(i.ifCheckedTags[d].ID);for(var e=[],d=0;d<i.imgs.data.length;d++)e.push({Seq:d,ImageURL:i.imgs.data[d].src,ImageSize:i.imgs.data[d].fileSize});if(0==e.length)return void i.addAlert(" 请上传图片",!1,"warning");i.saving=!0;var g=JSON.stringify({action:"updateRoom",token:f.getParams("token"),lang:f.langStyle(),roomID:i.roomId,tags:a,IntroImgs:e,roomDetail:{HotelID:i.hotelId,Description:i.room.Description,RoomTypeName:i.room.RoomTypeName}});c({method:"POST",url:f.getApiUrl("room","","server"),data:g}).then(function(a){var c=a.data;"200"==c.rescode?(alert("保存成功"),b.reload()):alert("保存失败，"+c.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.deleteById(c.data[0].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),b.abort()})}}}]).controller("roomEditPriceController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){function g(a,b){if(0==a.length)return!0;for(var c=a.length,d=new Array,e=0;e<c;e++){var f=a[e][b];if(d[f]){if(d[f]=d[f]+1,d[f]>1)return!1}else d[f]=1}return!0}var h,i,j=this;j.init=function(){j.hotelId=a.app.maskParams.hotelId,j.roomId=a.app.maskParams.roomId,h=f.langStyle(),i=f.getParams("token"),j.SpecialPrice=[],j.roomDetail=[],j.load()},j.cancel=function(){a.app.showHideMask(!1)},j.today=function(a){j.SpecialPrice[a].PriceDate=new Date},j.open=function(a){j.SpecialPrice[a].Opened=!0},j.addTemporary=function(a){j.SpecialPrice.splice(a,0,{RoomID:j.roomId,PriceDate:new Date,Price:0,PriceType:"basic",Opened:!1})},j.deleteTemporary=function(a){j.SpecialPrice.splice(a,1)},j.load=function(){var a=JSON.stringify({action:"getRoomInfoByID",lang:h,token:i,roomID:j.roomId,bookStartDate:f.getToday(),bookEndDate:f.getTomorrow()});j.loading=!0,c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){j.roomDetail.PriceMonday=b.PriceMonday/100,j.roomDetail.PriceTuesday=b.PriceTuesday/100,j.roomDetail.PriceWednesday=b.PriceWednesday/100,j.roomDetail.PriceThursday=b.PriceThursday/100,j.roomDetail.PriceFriday=b.PriceFriday/100,j.roomDetail.PriceSaturday=b.PriceSaturday/100,j.roomDetail.PriceSunday=b.PriceSunday/100;for(var c=0;c<b.SpecialPrice.length;c++)b.SpecialPrice[c].PriceDate=new Date(b.SpecialPrice[c].PriceDate),b.SpecialPrice[c].Price=b.SpecialPrice[c].Price/100;j.SpecialPrice=b.SpecialPrice}else"401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("读取价格信息失败，"+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.loading=!1})},j.save=function(){j.saving=!0;for(var a=[],d=0;d<j.SpecialPrice.length;d++)a.push({RoomID:j.roomId.toString(),PriceDate:f.format_yyyyMMdd(j.SpecialPrice[d].PriceDate),Price:100*Number(j.SpecialPrice[d].Price),PriceType:"basic"});if(!g(a,"PriceDate"))return alert("同一天不能重复设置"),j.saving=!1,!1;var k=JSON.stringify({action:"setRoomPrice",lang:h,token:i,roomID:j.roomId,SpecialPrice:a,roomDetail:{PriceMonday:100*Number(j.roomDetail.PriceMonday),PriceTuesday:100*Number(j.roomDetail.PriceTuesday),PriceWednesday:100*Number(j.roomDetail.PriceWednesday),PriceThursday:100*Number(j.roomDetail.PriceThursday),PriceFriday:100*Number(j.roomDetail.PriceFriday),PriceSaturday:100*Number(j.roomDetail.PriceSaturday),PriceSunday:100*Number(j.roomDetail.PriceSunday)}});c({method:"POST",url:f.getApiUrl("room","","server"),data:k}).then(function(a){var c=a.data;"200"==c.rescode?(alert("保存成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("保存失败，"+c.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.saving=!1})}}]).controller("roomEditNumController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){function g(a,b){if(0==a.length)return!0;for(var c=a.length,d=new Array,e=0;e<c;e++){var f=a[e][b];if(d[f]){if(d[f]=d[f]+1,d[f]>1)return!1}else d[f]=1}return!0}var h,i,j=this;j.init=function(){j.delAvailableDate=[],j.hotelId=a.app.maskParams.hotelId,j.roomId=a.app.maskParams.roomId,h=f.langStyle(),i=f.getParams("token"),j.SpecialNum=[],j.roomDetail=[],j.load()},j.cancel=function(){a.app.showHideMask(!1)},j.today=function(a){j.SpecialNum[a].PriceDate=new Date},j.open=function(a){j.SpecialNum[a].Opened=!0},j.addTemporary=function(a){j.SpecialNum.splice(a,0,{RoomID:j.roomId,AvailableDate:new Date,AvailableNumCurrent:0,AvailableNumSet:999,Opened:!1})},j.deleteTemporary=function(a,b){j.SpecialNum.splice(a,1),j.delAvailableDate.push(b)},j.load=function(){var a=JSON.stringify({action:"getRoomInfoByID",lang:h,token:i,roomID:j.roomId,bookStartDate:f.getToday(),bookEndDate:f.getTomorrow()});j.loading=!0,c({method:"POST",url:f.getApiUrl("room","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){j.roomDetail.AvailableNum=b.AvailableNum;for(var c=0;c<b.SpecialNum.length;c++)b.SpecialNum[c].AvailableDate=new Date(b.SpecialNum[c].AvailableDate),b.SpecialNum[c].disable=!0;j.SpecialNum=b.SpecialNum}else"401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("读取数量信息失败，"+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.loading=!1})},j.save=function(){j.saving=!0;for(var a=[],d=0;d<j.SpecialNum.length;d++)a.push({RoomID:j.roomId.toString(),AvailableDate:f.format_yyyyMMdd(j.SpecialNum[d].AvailableDate),AvailableNumCurrent:Number(j.SpecialNum[d].AvailableNumCurrent),AvailableNumSet:Number(j.SpecialNum[d].AvailableNumCurrent)});if(!g(a,"AvailableDate"))return alert("同一天不能重复设置"),j.saving=!1,!1;var k=JSON.stringify({action:"setRoomNum",lang:h,token:i,roomID:j.roomId,AvailableInfo:a,roomDetail:{AvailableNum:Number(j.roomDetail.AvailableNum)}});c({method:"POST",url:f.getApiUrl("room","","server"),data:k}).then(function(a){var c=a.data;"200"==c.rescode?(alert("保存成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("保存失败，"+c.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.saving=!1})},j.deleteDate=function(){if(0==j.delAvailableDate.length)return void j.save();j.saving=!0;for(var a=[],b=0;b<j.delAvailableDate.length;b++)a[b]={},a[b].RoomID=j.roomId+"",a[b].AvailableDate=j.delAvailableDate[b];var d=JSON.stringify({action:"delRoomNum",lang:h,token:i,roomID:j.roomId,dellist:a});c({method:"POST",url:f.getApiUrl("room","","server"),data:d}).then(function(a){var b=a.data;"200"==b.rescode?j.save():"401"==b.rescode?(alert("访问超时，请重新登录"),e.path("pages/login.html")):alert("保存失败，"+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){j.saving=!1})}}])}(),function(){angular.module("app.tv-admin-controllers",[]).controller("tvAdminController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i,j=this;a.my_tree=i={},j.init=function(){j.initS=d.label?d.label:"欢迎页面",j.menuRoot=!1,j.MainMenu_THJ_SecondMenu=!1,j.MainMenu_SX_SecondMenu=!1,j.editLangs=f.getParams("editLangs"),j.menu={}},j.deleteMenu=function(){if(confirm("确认删除？")){var a=i.get_selected_branch().data.menuLevel,d=i.get_selected_branch().data.menuId,e=1==a?"deleteMainMenuFirstMenu":"deleteMainMenuSecondMenu",g={};1==a?g.firstMenuID=d:g.SecondMenuID=d;var h=JSON.stringify({token:f.getParams("token"),action:e,viewID:1,data:g,lang:f.langStyle()});j.menuDeleting=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:h}).then(function(a){var c=a.data;if("200"==c.rescode){var d,e;d=i.get_selected_branch(),e=i.get_parent_branch(d),e.children.splice(e.children.indexOf(d),1),alert("已删除"),b.go("app.tvAdmin.blank",{label:e.label},{reload:!0})}else"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){j.menuDeleting=!1})}},j.changeWelStyle=function(){a.app.maskParams={viewName:i.get_selected_branch().data.viewName},a.app.showHideMask(!0,"pages/tv/welStyleChange.html")},j.changeMainStyle=function(){a.app.maskParams={viewName:i.get_selected_branch().data.viewName},a.app.showHideMask(!0,"pages/tv/styleChange.html")},j.addMenu=function(b,c){a.app.maskParams={menuLv:b},a.app.showHideMask(!0,"pages/tv/menuAdd.html")},j.addModule=function(b){var c={};1!=b&&(c={id:i.get_selected_branch().data.menuId,name:i.get_selected_branch().label}),a.app.maskParams={menuLv:b,parentMenu:c},a.app.showHideMask(!0,"pages/tv/moduleAdd.html")},a.my_tree_handler=function(a){console&&console.log("select "+a.label),"welcome"==a.data.type&&b.go("app.tvAdmin.welcome",{label:a.label}),"version"==a.data.type&&b.go("app.tvAdmin.version",{label:a.label}),"guangGaoWei"==a.data.type&&b.go("app.tvAdmin.guangGaoWei",{label:a.label}),"menuRoot"==a.data.type&&b.go("app.tvAdmin.blank",{label:a.label}),"Live"==a.data.type&&(b.go("app.tvAdmin.live",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"Live_SX"==a.data.type&&(b.go("app.tvAdmin.Live_SX",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"SimplePicText"==a.data.type&&(b.go("app.tvAdmin.simplePicText",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"SimpleSmallPicText"==a.data.type&&(b.go("app.tvAdmin.SimpleSmallPicText",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MultPic"==a.data.type&&(b.go("app.tvAdmin.multPic",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"PicText_Classification"==a.data.type&&(b.go("app.tvAdmin.PicText_Classification",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MultPic_SX_Small"==a.data.type&&(b.go("app.tvAdmin.MultPic_SX_Small",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MultPic_SX_Big"==a.data.type&&(b.go("app.tvAdmin.MultPic_SX_Big",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"SimplePicText_Price"==a.data.type&&(b.go("app.tvAdmin.SimplePicText_Price",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"SimplePicText_SX"==a.data.type&&(b.go("app.tvAdmin.SimplePicText_SX",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"PicText_Classification_SX"==a.data.type&&(b.go("app.tvAdmin.PicText_Classification_SX",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"3rdApp"==a.data.type&&(b.go("app.tvAdmin.3rdApp",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"ApkEntry"==a.data.type&&(b.go("app.tvAdmin.apkEntry",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"WorldClock"==a.data.type&&(b.go("app.tvAdmin.worldClock",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"Shop"==a.data.type&&(b.go("app.tvAdmin.shop",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MovieCommon"==a.data.type&&(b.go("app.tvAdmin.movieCommon",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MovieCommonAdv"==a.data.type&&(b.go("app.tvAdmin.movieCommonAdv",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MovieCommonFree"==a.data.type&&(b.go("app.tvAdmin.movieCommonFree",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MusicCommon"==a.data.type&&(b.go("app.tvAdmin.MusicCommon",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MusicCommon_SX"==a.data.type&&(b.go("app.tvAdmin.MusicCommon_SX",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"Weather_SX"==a.data.type&&(b.go("app.tvAdmin.Weather_SX",{moduleId:a.data.moduleId,label:a.label}),j.changeMenuInfo()),"MainMenu_THJ_SecondMenu"!=a.data.type&&"MainMenu_SX_SecondMenu"!=a.data.type||(b.go("app.tvAdmin.blank",{label:a.label}),j.changeMenuInfo())},j.changeMenuInfo=function(){var a=JSON.stringify(i.get_selected_branch().data.name);j.menu.name=JSON.parse(a),j.imgs3=new h([{ImageURL:i.get_selected_branch().data.img,ImageSize:i.get_selected_branch().data.imgSize}],!0),j.imgs3.initImgs(),j.imgs4=new h([{ImageURL:i.get_selected_branch().data.focusImg,ImageSize:i.get_selected_branch().data.focusImgSize}],!0),j.imgs4.initImgs(),j.menu.seq=i.get_selected_branch().data.seq,j.menuSaving=!1},j.saveTvMenu=function(){var a=i.get_selected_branch().data.menuLevel,d=1==a?"editMainMenuFirstMenu":"editMainMenuSecondMenu",e=i.get_selected_branch().data.menuId,g=JSON.stringify({token:f.getParams("token"),action:d,viewID:1,data:{firstMenuID:e,SecondMenuID:e,Name:j.menu.name,IconURL:j.imgs3.data[0].src,IconSize:j.imgs3.data[0].fileSize,IconFocusURL:j.imgs4.data[0].src,IconFocusSize:j.imgs4.data[0].fileSize,Seq:Number(j.menu.seq)},lang:f.langStyle()});j.menuSaving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:g}).then(function(a){var c=a.data;"200"==c.rescode?(alert("保存成功"),b.go(b.current,{label:j.menu.name[f.getDefaultLangCode()]},{reload:!0})):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("保存失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){j.menuSaving=!1})},j.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=b,h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvWelcomeController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.editLangs=f.getParams("editLangs"),i.getWelInfo()},i.getWelInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getWelcomePage",lang:f.langStyle()});i.loading=!0,c({method:"POST",url:f.getApiUrl("welcomepage","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(c.data.LogoURL?(i.imgs1=new h([{ImageURL:c.data.LogoURL,ImageSize:c.data.LogoSize}],!0),i.imgs1.initImgs()):i.imgs1=new h([],!0),i.welcomeText=c.data.WelcomeText,i.guestName=c.data.GuestName,i.hotelManagerName=c.data.HotelManagerName,c.data.BackgroundVideoURL?(i.imgs3=new h([{ImageURL:c.data.BackgroundVideoURL,ImageSize:c.data.BackgroundVideoSize}],!0),i.imgs3.initImgs()):i.imgs3=new h([],!0)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载欢迎页信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.loading=!1})},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传酒店logo图");if(0==i.imgs3.data.length)return void alert("请上传背景视频");if(i.imgs3.data[0].progress<100)return void alert("视频正在上传中，请稍后...");if(i.imgs3.data[0].progress==-1)return void alert("视频上传失败，请重新上传");var a=JSON.stringify({token:f.getParams("token"),action:"editWelcomePage",viewID:0,data:{LogoURL:i.imgs1.data[0].src,LogoSize:i.imgs1.data[0].fileSize,WelcomeText:i.welcomeText,GuestName:i.guestName,HotelManagerName:i.hotelManagerName,HotelManageSignURL:"",HotelManageSignSize:0,BackgroundVideoURL:i.imgs3.data[0].src,BackgroundVideoSize:i.imgs3.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("welcomepage","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载菜单示意信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.loading=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=b,h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvLiveEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.liveInfo=a.app.maskParams.liveInfo,i.editLangs=f.getParams("editLangs"),i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.channelNum=i.liveInfo.ChannelNum,i.channelName=i.liveInfo.ChannelName,i.src=i.liveInfo.Src,i.imgs1=new h([{ImageURL:i.liveInfo.ChannelPicURL,ImageSize:i.liveInfo.ChannelPicSize}],!0),i.imgs1.initImgs()},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"editChannel",viewID:Number(i.viewId),data:{ID:Number(i.liveInfo.ID),Src:i.src,ChannelNum:i.channelNum,ChannelPicURL:i.imgs1.data[0].src,ChannelName:i.channelName,ChannelPicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvLiveAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"addChannel",viewID:Number(i.viewId),data:{Src:i.src,ChannelNum:i.channelNum,ChannelPicURL:i.imgs1.data[0].src,ChannelName:i.channelName,ChannelPicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvLiveController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),
g.loadLiveList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.liveInfo=g.lives[b],a.app.showHideMask(!0,"pages/tv/liveEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delChannel",viewID:g.viewId,data:{ChannelList:[{ID:a-0}]},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.lives.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/liveAdd.html")},g.loadLiveList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.lives=c.data.ChannelList:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载直播列表信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvSimplePicTextEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.Title=i.picInfo.Title,i.Text=i.picInfo.Text,i.imgs1=new h([{ImageURL:i.picInfo.PicURL,ImageSize:i.picInfo.PicSize}],!0),i.imgs1.initImgs(),console.log(i.imgs1)},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq,Title:i.Title,PicURL:i.imgs1.data[0].src,Text:i.Text,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var a=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvClassPicTextAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.cateId=a.app.maskParams.cateId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var d=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PID:i.cateId,PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:d}).then(function(c){var d=c.data;"200"==d.rescode?(a.app.showHideMask(!1),a.app.maskParams.loadInfo()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvClassPicTextEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.cateId=a.app.maskParams.cateId,i.info=a.app.maskParams.info,i.Seq=i.info.Seq,i.Text=i.info.Text,i.Title=i.info.Title,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([{ImageURL:i.info.PicURL,ImageSize:i.info.PicSize}],!0),i.imgs1.initImgs()},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var d=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{PID:i.info.ID,PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:d}).then(function(c){var d=c.data;"200"==d.rescode?(a.app.showHideMask(!1),a.app.maskParams.loadInfo()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/simplePicTextEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/simplePicTextAdd.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.pics=c.data.res:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvSimpleSmallPicTextEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.Title=i.picInfo.Title,i.Text=i.picInfo.Text,i.imgs1=new h([{ImageURL:i.picInfo.PicURL,ImageSize:i.picInfo.PicSize}],!0),i.imgs1.initImgs(),console.log(i.imgs1)},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq,Title:i.Title,PicURL:i.imgs1.data[0].src,Text:i.Text,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimpleSmallPicTextAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var a=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimpleSmallPicTextController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/SimpleSmallPicTextEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/SimpleSmallPicTextAdd.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.pics=c.data.res:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvMultPicController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,console.log(g.viewId),g.defaultLangCode=f.getDefaultLangCode(),console.log(g.defaultLangCode),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/multPicEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/multPicAdd.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.pics=c.data.pic,console.log(g.pics)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvMultPicEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.langArr=[],i.langNameArr=[],i.upImgs=[],i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.images=i.picInfo.SourceData;for(var a in i.images)for(var b=0;b<i.editLangs.length;b++)a==i.editLangs[b].code&&(i.langNameArr.push(i.editLangs[b].name),i.langArr.push(a));for(var b=0;b<i.langArr.length;b++){var c=i.langArr[b];i.upImgs[b]=new h([{ImageURL:i.images[c].PicURL,ImageSize:i.images[c].PicSize}],!0),i.upImgs[b].initImgs(),console.log(i.upImgs[b])}},i.save=function(){for(var a={token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq},lang:f.langStyle()},d=0;d<i.langArr.length;d++){var e=i.langArr[d],g=i.upImgs[d].data[0].src,h=i.upImgs[d].data[0].fileSize;a.data[e]={PicURL:g,PicSize:h}}console.log(a),a=JSON.stringify(a),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvMultPicAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.uplImgs=[],i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.defaultLangCode=f.getDefaultLangCode();for(var b=0;b<i.editLangs.length;b++)i.uplImgs[b]=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){for(var a,d=0;d<i.editLangs.length;d++)i.editLangs[d].code==i.defaultLangCode&&(a=d);if(0==i.uplImgs[a].data.length||i.uplImgs[a].data[0].progress<100)return void alert("请上传默认语言图片");for(var e={token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:[{Seq:i.Seq,SourceData:{}}],lang:f.langStyle()},d=0;d<i.editLangs.length;d++){var g=i.editLangs[d].code;e.data[0].SourceData[g]={PicURL:i.uplImgs[d].data[0].src,PicSize:i.uplImgs[d].data[0].fileSize}}console.log(e),e=JSON.stringify(e),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvMultPicSxSmallController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,console.log(g.viewId),g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/MultPic_SX_Small_Edit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/MultPic_SX_Small_Add.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.pics=c.data.pic,console.log(g.pics)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvMultPicSxSmallEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.langArr=[],i.langNameArr=[],i.upImgs=[],i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.images=i.picInfo.SourceData;for(var a in i.images)for(var b=0;b<i.editLangs.length;b++)a==i.editLangs[b].code&&(i.langNameArr.push(i.editLangs[b].name),i.langArr.push(a));for(var b=0;b<i.langArr.length;b++){var c=i.langArr[b];i.upImgs[b]=new h([{ImageURL:i.images[c].PicURL,ImageSize:i.images[c].PicSize}],!0),i.upImgs[b].initImgs(),console.log(i.upImgs[b])}},i.save=function(){for(var a={token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq},lang:f.langStyle()},d=0;d<i.langArr.length;d++){var e=i.langArr[d],g=i.upImgs[d].data[0].src,h=i.upImgs[d].data[0].fileSize;a.data[e]={PicURL:g,PicSize:h}}console.log(a),a=JSON.stringify(a),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvMultPicSxSmallAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.uplImgs=[],i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.defaultLangCode=f.getDefaultLangCode();for(var b=0;b<i.editLangs.length;b++)i.uplImgs[b]=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){for(var a,d=0;d<i.editLangs.length;d++)i.editLangs[d].code==i.defaultLangCode&&(a=d);if(0==i.uplImgs[a].data.length||i.uplImgs[a].data[0].progress<100)return void alert("请上传默认语言图片");for(var e={token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:[{Seq:i.Seq,SourceData:{}}],lang:f.langStyle()},d=0;d<i.editLangs.length;d++){var g=i.editLangs[d].code;e.data[0].SourceData[g]={PicURL:i.uplImgs[d].data[0].src,PicSize:i.uplImgs[d].data[0].fileSize
}}console.log(e),e=JSON.stringify(e),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvMultPicSxBigController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,console.log(g.viewId),g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/MultPic_SX_Big_Edit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/MultPic_SX_Big_Add.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.pics=c.data.pic,console.log(g.pics)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvMultPicSxBigEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.langArr=[],i.langNameArr=[],i.upImgs=[],i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.images=i.picInfo.SourceData;for(var a in i.images)for(var b=0;b<i.editLangs.length;b++)a==i.editLangs[b].code&&(i.langNameArr.push(i.editLangs[b].name),i.langArr.push(a));for(var b=0;b<i.langArr.length;b++){var c=i.langArr[b];i.upImgs[b]=new h([{ImageURL:i.images[c].PicURL,ImageSize:i.images[c].PicSize}],!0),i.upImgs[b].initImgs(),console.log(i.upImgs[b])}},i.save=function(){for(var a={token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq},lang:f.langStyle()},d=0;d<i.langArr.length;d++){var e=i.langArr[d],g=i.upImgs[d].data[0].src,h=i.upImgs[d].data[0].fileSize;a.data[e]={PicURL:g,PicSize:h}}console.log(a),a=JSON.stringify(a),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvMultPicSxBigAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.uplImgs=[],i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.defaultLangCode=f.getDefaultLangCode();for(var b=0;b<i.editLangs.length;b++)i.uplImgs[b]=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){for(var a,d=0;d<i.editLangs.length;d++)i.editLangs[d].code==i.defaultLangCode&&(a=d);if(0==i.uplImgs[a].data.length||i.uplImgs[a].data[0].progress<100)return void alert("请上传默认语言图片");for(var e={token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:[{Seq:i.Seq,SourceData:{}}],lang:f.langStyle()},d=0;d<i.editLangs.length;d++){var g=i.editLangs[d].code;e.data[0].SourceData[g]={PicURL:i.uplImgs[d].data[0].src,PicSize:i.uplImgs[d].data[0].fileSize}}console.log(e),e=JSON.stringify(e),i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextPriceController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/SimplePicText_PriceEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/SimplePicText_PriceAdd.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(console.log(c),g.pics=c.data.apk):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvSimplePicTextPriceEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.Title=i.picInfo.Title,i.Text=i.picInfo.Text,i.Price=i.picInfo.Price,i.imgs1=new h([{ImageURL:i.picInfo.PicURL,ImageSize:i.picInfo.PicSize}],!0),i.imgs1.initImgs(),console.log(i.imgs1)},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq,Title:i.Title,PicURL:i.imgs1.data[0].src,Text:i.Text,Price:i.Price,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextPriceAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var a=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,Price:i.Price,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextSXController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.picInfo=g.pics[b],a.app.showHideMask(!0,"pages/tv/SimplePicText_SX_Edit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,data:{ID:a-0},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.pics.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/SimplePicText_SX_Add.html")},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.pics=c.data.apk:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}]).controller("tvSimplePicTextSXAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var a=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvSimplePicTextSXEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.picInfo=a.app.maskParams.picInfo,i.editLangs=f.getParams("editLangs"),i.setInfo()},i.cancel=function(){a.app.showHideMask(!1)},i.setInfo=function(){i.Seq=i.picInfo.Seq,i.Title=i.picInfo.Title,i.Text=i.picInfo.Text,i.imgs1=new h([{ImageURL:i.picInfo.PicURL,ImageSize:i.picInfo.PicSize}],!0),i.imgs1.initImgs(),console.log(i.imgs1)},i.save=function(){if(0==i.imgs1.data.length)return void alert("请上传频道图片");var a=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{ID:Number(i.picInfo.ID),Seq:i.Seq,Title:i.Title,PicURL:i.imgs1.data[0].src,Text:i.Text,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvPicTextClassListSXController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.info=[],g.cateIndex,g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadInfo()},g.addCategory=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/PicTextClassCateAdd_SX.html")},g.delCate=function(){if(confirm("确认删除？")){var a=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,lang:f.langStyle(),data:{ID:g.info[g.cateIndex].ID}});g.cateDeleting=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?g.loadInfo():alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.cateDeleting=!1})}},g.editCate=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.info=g.info[g.cateIndex],a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/PicTextClassCateEdit_SX.html")},g.editPic=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.cateId=g.info[g.cateIndex].ID,a.app.maskParams.info=g.info[g.cateIndex].sub[b],a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/classPicTextEdit_SX.html")},g.addPic=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.cateId=g.info[g.cateIndex].ID,a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/classPicTextAdd_SX.html")},g.delPic=function(a){if(confirm("确认删除？")){var b=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,lang:f.langStyle(),data:{PID:g.info[g.cateIndex].sub[a].ID}});g.picDeleting=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?g.loadInfo():alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.picDeleting=!1})}},g.loadInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(g.info=b.data.res,(!g.cateIndex||g.cateIndex+1>g.info.length)&&(g.cateIndex=0),0==g.info.length&&(g.info[0].sub=[])):alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.loadPics=function(a){g.cateIndex=a}}]).controller("tvPicTextClassCateAddSXController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.viewId=0,i.imgs1=null,i.editLangs=f.getParams("editLangs"),i.init=function(){i.viewId=a.app.maskParams.viewId,i.imgs1=new h([],!0),i.imgs2=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(!i.imgs1.data[0]||!i.imgs1.data[0].src)return void alert("请上传图片");var b=JSON.stringify({token:f.getParams("token"),action:"add",viewID:i.viewId-0,lang:f.langStyle(),data:{PicURL:i.imgs1.data[0].src,Text:i.cateName,Title:i.cateName,Seq:i.Seq,PicSize:i.imgs1.data[0].fileSize-0,IconURL:i.imgs2.data[0].src,IconSize:i.imgs2.data[0].fileSize-0}});return i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(b){a.app.showHideMask(!1),a.app.maskParams.loadInfo()},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvPicTextClassCateEditSXController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.viewId=0,i.imgs1=null,i.imgs2=null,i.editLangs=f.getParams("editLangs"),i.init=function(){i.viewId=a.app.maskParams.viewId,i.info=a.app.maskParams.info,i.Seq=i.info.Seq,i.cateName=i.info.Title,i.imgs1=new h([{ImageURL:i.info.PicURL,ImageSize:i.info.PicSize}],!0),i.imgs1.initImgs(),i.imgs2=new h([{ImageURL:i.info.IconURL,ImageSize:i.info.IconSize}],!0),i.imgs2.initImgs()},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(!i.imgs1.data[0]||!i.imgs1.data[0].src)return void alert("请上传图片");var b=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:i.viewId-0,lang:f.langStyle(),data:{ID:i.info.ID,PicURL:i.imgs1.data[0].src,Text:i.cateName,Title:i.cateName,Seq:i.Seq,PicSize:i.imgs1.data[0].fileSize-0,IconURL:i.imgs2.data[0].src,IconSize:i.imgs2.data[0].fileSize-0}});return i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(b){a.app.showHideMask(!1),a.app.maskParams.loadInfo()},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvClassPicTextAddSXController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.cateId=a.app.maskParams.cateId,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var d=JSON.stringify({token:f.getParams("token"),action:"add",viewID:Number(i.viewId),data:{PID:i.cateId,PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,Addr:i.Addr,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:d}).then(function(c){var d=c.data;"200"==d.rescode?(a.app.showHideMask(!1),a.app.maskParams.loadInfo()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){
if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvClassPicTextEditSXController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.viewId=a.app.maskParams.viewId,i.cateId=a.app.maskParams.cateId,i.info=a.app.maskParams.info,i.Seq=i.info.Seq,i.Text=i.info.Text,i.Title=i.info.Title,i.Addr=i.info.Addr,i.editLangs=f.getParams("editLangs"),i.imgs1=new h([{ImageURL:i.info.PicURL,ImageSize:i.info.PicSize}],!0),i.imgs1.initImgs()},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传图片");var d=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:Number(i.viewId),data:{PID:i.info.ID,PicURL:i.imgs1.data[0].src,Seq:i.Seq,Text:i.Text,Title:i.Title,Addr:i.Addr,PicSize:i.imgs1.data[0].fileSize},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:d}).then(function(c){var d=c.data;"200"==d.rescode?(a.app.showHideMask(!1),a.app.maskParams.loadInfo()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("添加失败，"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvShopController",["$scope","$state","$http","$stateParams","util",function(a,b,c,d,e){var f=this;f.init=function(){f.viewId=d.moduleId,f.loadInfo()},f.save=function(){var a=JSON.stringify({token:e.getParams("token"),action:"update",viewID:f.viewId-0,lang:e.langStyle(),data:{ShopType:f.shopSign}});f.saving=!0,c({method:"POST",url:e.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?alert("保存成功"):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("保存失败，"+c.errInfo)},function(a){alert("保存失败")}).finally(function(a){f.saving=!1})},f.loadInfo=function(){var a=JSON.stringify({token:e.getParams("token"),action:"get",viewID:f.viewId-0,lang:e.langStyle()});f.loading=!0,c({method:"POST",url:e.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?f.shopSign=c.data.ShopType:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){f.loading=!1})}}]).controller("tvPicTextClassListController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.info=[],g.cateIndex,g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadInfo()},g.addCategory=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/PicTextClassCateAdd.html")},g.delCate=function(){if(confirm("确认删除？")){var a=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,lang:f.langStyle(),data:{ID:g.info[g.cateIndex].ID}});g.cateDeleting=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?g.loadInfo():alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.cateDeleting=!1})}},g.editCate=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.info=g.info[g.cateIndex],a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/PicTextClassCateEdit.html")},g.editPic=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.cateId=g.info[g.cateIndex].ID,a.app.maskParams.info=g.info[g.cateIndex].sub[b],a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/classPicTextEdit.html")},g.addPic=function(){a.app.maskParams.viewId=g.viewId,a.app.maskParams.cateId=g.info[g.cateIndex].ID,a.app.maskParams.loadInfo=g.loadInfo,a.app.showHideMask(!0,"pages/tv/classPicTextAdd.html")},g.delPic=function(a){if(confirm("确认删除？")){var b=JSON.stringify({token:f.getParams("token"),action:"delete",viewID:g.viewId,lang:f.langStyle(),data:{PID:g.info[g.cateIndex].sub[a].ID}});g.picDeleting=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?g.loadInfo():alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.picDeleting=!1})}},g.loadInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(g.info=b.data.res,(!g.cateIndex||g.cateIndex+1>g.info.length)&&(g.cateIndex=0),0==g.info.length&&(g.info[0].sub=[])):alert("连接服务器出错"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.loadPics=function(a){g.cateIndex=a}}]).controller("tvPicTextClassCateAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.viewId=0,i.imgs1=null,i.editLangs=f.getParams("editLangs"),i.init=function(){i.viewId=a.app.maskParams.viewId,i.imgs1=new h([],!0)},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(!i.imgs1.data[0]||!i.imgs1.data[0].src)return void alert("请上传图片");var b=JSON.stringify({token:f.getParams("token"),action:"add",viewID:i.viewId-0,lang:f.langStyle(),data:{PicURL:i.imgs1.data[0].src,Text:i.cateName,Title:i.cateName,Seq:i.Seq,PicSize:i.imgs1.data[0].fileSize-0}});return i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(b){a.app.showHideMask(!1),a.app.maskParams.loadInfo()},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvPicTextClassCateEditController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.viewId=0,i.imgs1=null,i.editLangs=f.getParams("editLangs"),i.init=function(){i.viewId=a.app.maskParams.viewId,i.info=a.app.maskParams.info,i.Seq=i.info.Seq,i.cateName=i.info.Title,i.imgs1=new h([{ImageURL:i.info.PicURL,ImageSize:i.info.PicSize}],!0),i.imgs1.initImgs()},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(!i.imgs1.data[0]||!i.imgs1.data[0].src)return void alert("请上传图片");var b=JSON.stringify({token:f.getParams("token"),action:"edit",viewID:i.viewId-0,lang:f.langStyle(),data:{ID:i.info.ID,PicURL:i.imgs1.data[0].src,Text:i.cateName,Title:i.cateName,Seq:i.Seq,PicSize:i.imgs1.data[0].fileSize-0}});return i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:b}).then(function(b){a.app.showHideMask(!1),a.app.maskParams.loadInfo()},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tv3rdAppController",["$scope","$state","$http","$stateParams","util",function(a,b,c,d,e){var f=this;f.init=function(){f.viewId=d.moduleId,f.loadInfo()},f.edit=function(){a.app.maskParams.viewId=f.viewId,a.app.maskParams.appGroupID=f.info.AppGroupID,a.app.maskParams.callback=f.loadInfo,a.app.showHideMask(!0,"pages/tv/3rdAppEdit.html")},f.add=function(){a.app.maskParams.viewId=f.viewId,a.app.maskParams.callback=f.loadInfo,a.app.showHideMask(!0,"pages/tv/3rdAppAdd.html")},f.loadInfo=function(){var a=JSON.stringify({token:e.getParams("token"),action:"getAppGroup",viewID:f.viewId-0,lang:e.langStyle()});f.loading=!0,c({method:"POST",url:e.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?f.info=c.data:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){f.loading=!1})}}]).controller("tv3rdAppAddController",["$scope","$http","util",function(a,b,c){var d=this;d.init=function(){d.viewId=a.app.maskParams.viewId,d.callback=a.app.maskParams.callback,d.loadList()},d.loadList=function(){var a=JSON.stringify({token:c.getParams("token"),action:"getAppGroupList",viewID:d.viewId-0,lang:c.langStyle()});d.loading=!0,b({method:"POST",url:c.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(d.appList=b.data,d.selApp=0):"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("加载信息失败，"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.loading=!1})},d.cancel=function(){a.app.showHideMask(!1)},d.save=function(){var a=JSON.stringify({token:c.getParams("token"),action:"updateAppGroup",viewID:Number(d.viewId),data:{AppGroupID:d.appList[d.selApp].ID,AppGroupName:d.appList[d.selApp].Name,AppGroupDesc:d.appList[d.selApp].Description},lang:c.langStyle()});d.saving=!0,b({method:"POST",url:c.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),d.cancel(),d.callback()):"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("保存失败，"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.saving=!1})}}]).controller("tv3rdAppEditController",["$scope","$http","util",function(a,b,c){var d=this;d.init=function(){d.viewId=a.app.maskParams.viewId,d.callback=a.app.maskParams.callback,d.appGroupID=a.app.maskParams.appGroupID,d.loadList()},d.loadList=function(){var a=JSON.stringify({token:c.getParams("token"),action:"getAppGroupList",viewID:d.viewId-0,lang:c.langStyle()});d.loading=!0,b({method:"POST",url:c.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){d.appList=b.data,d.selApp=0;for(var c=0;c<d.appList.length;c++)if(d.appList[c].ID==d.appGroupID){d.selApp=c;break}}else"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("加载信息失败，"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.loading=!1})},d.cancel=function(){a.app.showHideMask(!1)},d.save=function(){var a=JSON.stringify({token:c.getParams("token"),action:"updateAppGroup",viewID:Number(d.viewId),data:{AppGroupID:d.appList[d.selApp].ID,AppGroupName:d.appList[d.selApp].Name,AppGroupDesc:d.appList[d.selApp].Description},lang:c.langStyle()});d.saving=!0,b({method:"POST",url:c.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),d.cancel(),d.callback()):"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("保存失败，"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.saving=!1})}}]).controller("tvMovieCommonController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.getInfo()},g.getInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getAPIInfo",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.MovieContentAPIParam=c.data.MovieContentAPIParam,g.MovieContentAPIURL=c.data.MovieContentAPIURL):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载电影信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.save=function(){var a=JSON.stringify({token:f.getParams("token"),action:"updateAPIInfo",viewID:g.viewId-0,data:{MovieContentAPIParam:g.MovieContentAPIParam,MovieContentAPIURL:g.MovieContentAPIURL,PackageFee:g.PackageFee,FeeDiscount:g.FeeDiscount},lang:f.langStyle()});g.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?alert("修改成功"):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}]).controller("tvMovieCommonFreeController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.getInfo()},g.getInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getAPIInfo",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.MovieContentAPIParam=c.data.MovieContentAPIParam,g.MovieContentAPIURL=c.data.MovieContentAPIURL):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载电影信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.save=function(){var a=JSON.stringify({token:f.getParams("token"),action:"updateAPIInfo",viewID:g.viewId-0,data:{MovieContentAPIParam:g.MovieContentAPIParam,MovieContentAPIURL:g.MovieContentAPIURL},lang:f.langStyle()});g.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?alert("修改成功"):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}]).controller("tvMovieCommonAdvController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.getInfo()},g.getInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getAPIInfo",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(g.MovieContentAPIParam=c.data.MovieContentAPIParam,g.MovieContentAPIURL=c.data.MovieContentAPIURL):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载电影信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.save=function(){var a=JSON.stringify({token:f.getParams("token"),action:"updateAPIInfo",viewID:g.viewId-0,data:{MovieContentAPIParam:g.MovieContentAPIParam,MovieContentAPIURL:g.MovieContentAPIURL},lang:f.langStyle()});g.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?alert("修改成功"):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}]).controller("tvMenuAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.menuLv=a.app.maskParams.menuLv,i.editLangs=f.getParams("editLangs"),i.getMenuInfo(),i.imgs1=new h([],!0),i.imgs2=new h([],!0)},i.getMenuInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getMainMenuTemplate",lang:f.langStyle()});i.loading=!0,c({method:"POST",url:f.getApiUrl("mainmenu","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?i.styleImg=c.data.SamplePic:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载菜单示意信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.loading=!1})},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){if(0==i.imgs1.data.length||i.imgs1.data[0].progress<100)return void alert("请上传菜单图片");if(0==i.imgs2.data.length||i.imgs2.data[0].progress<100)return void alert("请上传菜单高亮图片");var a=JSON.stringify({token:f.getParams("token"),action:"addMainMenuFirstMenu",viewID:1,data:{isMenu:1,viewType:"",Name:i.menuName,IconURL:i.imgs1.data[0].src,IconSize:i.imgs1.data[0].fileSize,IconFocusURL:i.imgs2.data[0].src,IconFocusSize:i.imgs2.data[0].fileSize,Seq:i.seq},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载菜单示意信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvModuleAddController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var i=this;i.init=function(){i.menuLv=a.app.maskParams.menuLv,1!=i.menuLv&&(i.parentMenu=a.app.maskParams.parentMenu),i.editLangs=f.getParams("editLangs"),i.getModuleInfo(),i.imgs1=new h([],!0),i.imgs2=new h([],!0)},i.getModuleInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getCommonTemplate",lang:f.langStyle()});i.loading=!0,c({method:"POST",url:f.getApiUrl("mainmenu","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(i.modules=c.data,i.module=i.modules[0].Name):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载模版信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.loading=!1})},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){var a=1==i.menuLv?"addMainMenuFirstMenu":"addMainMenuSecondMenu",d=1==i.menuLv?"":i.parentMenu.id,e=JSON.stringify({token:f.getParams("token"),action:a,viewID:1,data:{isMenu:0,firstMenuID:d,viewType:i.module,Name:i.menuName,IconURL:i.imgs1.data[0]?i.imgs1.data[0].src:"",IconSize:i.imgs1.data[0]?i.imgs1.data[0].fileSize:0,IconFocusURL:i.imgs2.data[0]?i.imgs2.data[0].src:"",IconFocusSize:i.imgs2.data[0]?i.imgs2.data[0].fileSize:0,Seq:i.seq},lang:f.langStyle()});i.saving=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载菜单示意信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){i.saving=!1})},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}]).controller("tvStyleChangeController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.viewName=a.app.maskParams.viewName,h.getViewList()},h.getViewList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getMainMenuTemplateList",lang:f.langStyle()});h.loading=!0,c({method:"POST",url:f.getApiUrl("mainmenu","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(h.styles=c.data,h.style=h.viewName):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载首页模版失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.loading=!1})},h.cancel=function(){a.app.showHideMask(!1)},h.save=function(){if(confirm("修改会导致所有主菜单全部清空，确认修改？")&&confirm("再次确认：修改会导致所有主菜单全部清空，确认修改？")){var a=JSON.stringify({token:f.getParams("token"),action:"createMainMenu",viewID:1,viewType:h.style,lang:f.langStyle()});h.saving=!0,c({method:"POST",url:f.getApiUrl("mainmenu","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.saving=!1})}}}]).controller("tvWelStyleChangeController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.viewName=a.app.maskParams.viewName,h.getViewList()},h.getViewList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getWelcomePageTemplateList",lang:f.langStyle()});h.loading=!0,c({method:"POST",url:f.getApiUrl("welcomepage","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(h.styles=c.data,h.style=h.viewName):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载欢迎页模版失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.loading=!1})},h.cancel=function(){a.app.showHideMask(!1)},h.save=function(){var a=JSON.stringify({token:f.getParams("token"),action:"createWelcomePage",viewType:h.style,lang:f.langStyle()});h.saving=!0,c({method:"POST",url:f.getApiUrl("welcomepage","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("修改成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("修改失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.saving=!1})}}]).controller("tvAdvAddController",["$scope","$http","util",function(a,b,c){var d=this;d.init=function(){d.disabledList=a.app.maskParams.list,d.callback=a.app.maskParams.callback,d.loadList()},d.loadList=function(){var a=JSON.stringify({token:c.getParams("token"),action:"getPosList",lang:c.langStyle()});d.loading=!0,b({method:"POST",url:c.getApiUrl("advpos","","server"),data:a}).then(function(a){var b=a.data;if("200"==b.rescode){for(var c=(b.data,b.data),e=0;e<c.length;e++){c[e].disabled=!1,c[e].checked=!1;for(var f=0;f<d.disabledList.length;f++)if(c[e].ID==d.disabledList[f].PositionID){c[e].disabled=!0,c[e].checked=!0;break}}d.adList=c}else"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("加载广告位信息失败，"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.loading=!1})},d.save=function(a){for(var e=[],f=0;f<d.adList.length;f++)!d.adList[f].disabled&&d.adList[f].checked&&e.push({AdvPositionTemplateName:d.adList[f].AdvPositionTemplateName,ID:d.adList[f].ID,Name:d.adList[f].Name});if(0==e.length)return void alert("请选择要添加的广告");var g=JSON.stringify({token:c.getParams("token"),action:"addPos",lang:c.langStyle(),data:e});d.saving=!0,b({method:"POST",url:c.getApiUrl("advpos","","server"),data:g}).then(function(a){var b=a.data;"200"==b.rescode?(alert("添加成功"),d.cancel(),d.callback()):"401"==b.rescode?(alert("访问超时，请重新登录"),$state.go("login")):alert("添加失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){d.saving=!1})},d.cancel=function(){a.app.showHideMask(!1)}}]).controller("tvVersionController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.getSV(),g.getCV()},g.getSV=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",type:"All",lang:f.langStyle()});g.loadingS=!0,c({method:"POST",url:f.getApiUrl("tvuiversion","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.serviceVersion=c.data:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载服务器版本信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loadingS=!1})},g.getCV=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getProxyVersion",lang:f.langStyle()});g.loadingC=!0,c({method:"POST",url:f.getApiUrl("tvuiversion","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.clientVersion=c.data:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载小前端版本信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loadingC=!1})},g.submit=function(){var a=JSON.stringify({token:f.getParams("token"),action:"submit",type:"All",lang:f.langStyle()});g.saving=!0,alert("提交版本命令已发送，这需要大约一分钟的时间"),c({method:"POST",url:f.getApiUrl("tvuiversion","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?(alert("版本提交成功"),b.reload()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("提交版本失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.saving=!1})}}]).controller("tvGuangGaoWeiController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.loadList()},g.loadList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getPosOpenList",lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("advpos","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.adList=c.data:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载广告位信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})},g.close=function(a){if(confirm("确认删除？")){var d=JSON.stringify({token:f.getParams("token"),action:"delPos",lang:f.langStyle(),data:[{PositionID:a}]});c({method:"POST",url:f.getApiUrl("advpos","","server"),data:d}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.loadList()):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){})}},g.add=function(){a.app.maskParams={list:g.adList},a.app.maskParams.callback=g.loadList,a.app.showHideMask(!0,"pages/tv/advAdd.html")}}]).controller("tvWorldClockController",["$q","$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){console.log("tvWorldClockController");var i=this;i.init=function(){}}]).controller("tvWeatherSXController",["$q","$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){console.log("tvWeatherSXController");
var i=this;i.init=function(){}}]).controller("tvMusicCommonController",["$q","$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){function i(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}console.log("tvMusicCommonController");var j=this;j.init=function(){j.info={},j.viewId=e.moduleId,j.defaultLangCode=g.getDefaultLangCode(),j.editLangs=g.getParams("editLangs"),j.getInfo().then(function(){j.initImgs1()})},j.getInfo=function(){var b=a.defer();j.loading=!0;var c=JSON.stringify({action:"getAPIInfo",token:g.getParams("token"),lang:g.langStyle(),viewID:Number(j.viewId)});return d({method:"POST",url:g.getApiUrl("commonview","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(j.info=c.data,b.resolve()):"401"==c.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):(alert("读取信息失败，"+c.errInfo),b.reject())},function(a){alert("服务器出错"),b.reject()}).finally(function(a){j.loading=!1}),b.promise},j.initImgs1=function(){j.imgs1=new i([{ImageURL:j.info.ApkURL,ImageSize:j.info.ApkSize}],!0),j.imgs1.initImgs()},j.save=function(){if(0==j.imgs1.data.length)return void alert("请上传酒店Apk");j.info.ApkURL=j.imgs1.data[0].src,j.info.ApkSize=j.imgs1.data[0].fileSize-0,j.saving=!0;var a=JSON.stringify({action:"updateAPIInfo",token:g.getParams("token"),lang:g.langStyle(),viewID:j.viewId-0,data:{MusicContentAPIParam:j.info.MusicContentAPIParam,MusicContentAPIURL:j.info.MusicContentAPIURL}});d({method:"POST",url:g.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),c.reload()):alert("保存失败，"+b.errInfo)},function(a){alert("服务器出错")}).finally(function(a){j.saving=!1})},j.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},i.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(a,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=b[a],f=h.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);g.uploadFileToUrl(i,e,f,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.update(j,b,a.total-a.loaded,a.total),console.log(b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeByXhr(a,d.upload_path,d.size),c.single&&c.deleteById(c.data[0].id)})},function(a){b.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),a.abort()})}}}]).controller("tvMusicCommonSXController",["$q","$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g,h){function i(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}console.log("tvMusicCommonController");var j=this;j.init=function(){j.info={},j.viewId=e.moduleId,j.defaultLangCode=g.getDefaultLangCode(),j.editLangs=g.getParams("editLangs"),j.getInfo().then(function(){j.initImgs1()})},j.getInfo=function(){var b=a.defer();j.loading=!0;var c=JSON.stringify({action:"getAPIInfo",token:g.getParams("token"),lang:g.langStyle(),viewID:Number(j.viewId)});return d({method:"POST",url:g.getApiUrl("commonview","","server"),data:c}).then(function(a){var c=a.data;"200"==c.rescode?(j.info=c.data,b.resolve()):"401"==c.rescode?(alert("访问超时，请重新登录"),$location.path("pages/login.html")):(alert("读取信息失败，"+c.errInfo),b.reject())},function(a){alert("服务器出错"),b.reject()}).finally(function(a){j.loading=!1}),b.promise},j.initImgs1=function(){j.imgs1=new i([{ImageURL:j.info.ApkURL,ImageSize:j.info.ApkSize}],!0),j.imgs1.initImgs()},j.save=function(){if(0==j.imgs1.data.length)return void alert("请上传酒店Apk");j.info.ApkURL=j.imgs1.data[0].src,j.info.ApkSize=j.imgs1.data[0].fileSize-0,j.saving=!0;var a=JSON.stringify({action:"updateAPIInfo",token:g.getParams("token"),lang:g.langStyle(),viewID:j.viewId-0,data:{MusicContentAPIParam:j.info.MusicContentAPIParam,MusicContentAPIURL:j.info.MusicContentAPIURL}});d({method:"POST",url:g.getApiUrl("commonview","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(alert("保存成功"),c.reload()):alert("保存失败，"+b.errInfo)},function(a){alert("服务器出错")}).finally(function(a){j.saving=!1})},j.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},i.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(a,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=b[a],f=h.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);g.uploadFileToUrl(i,e,f,"normal",function(a){b.$apply(function(){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);c.update(j,b,a.total-a.loaded,a.total),console.log(b)}})},function(a){var d=JSON.parse(a.responseText);console&&console.log(d),b.$apply(function(){c.setSrcSizeByXhr(a,d.upload_path,d.size),c.single&&c.deleteById(c.data[0].id)})},function(a){b.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),a.abort()})}}}]).controller("tvLiveSXController",["$scope","$state","$http","$stateParams","$location","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.viewId=d.moduleId,g.defaultLangCode=f.getDefaultLangCode(),g.loadLiveList()},g.edit=function(b){a.app.maskParams.viewId=g.viewId,a.app.maskParams.liveInfo=g.lives[b],a.app.showHideMask(!0,"pages/tv/liveEdit.html")},g.del=function(a,d){var d=d;if(confirm("确认删除？")){var e=JSON.stringify({token:f.getParams("token"),action:"delChannel",viewID:g.viewId,data:{ChannelList:[{ID:a-0}]},lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("commonview","","server"),data:e}).then(function(a){var c=a.data;"200"==c.rescode?(alert("删除成功"),g.lives.splice(d,1)):"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("删除失败，"+c.errInfo)},function(a){alert("连接服务器出错")})}},g.add=function(){a.app.maskParams.viewId=g.viewId,a.app.showHideMask(!0,"pages/tv/liveAdd.html")},g.loadLiveList=function(){var a=JSON.stringify({token:f.getParams("token"),action:"get",viewID:g.viewId-0,lang:f.langStyle()});g.loading=!0,c({method:"POST",url:f.getApiUrl("commonview","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?g.lives=c.data.ChannelList:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("加载直播列表信息失败，"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){g.loading=!1})}}])}(),function(){angular.module("app.project-config-controllers",[]).controller("projectConfigController",["$state",function(a){var b=this;b.init=function(){"app.projectConfig"==a.current.name&&a.go("app.projectConfig.hotelList")}}]).controller("pcHotelListController",["$scope","$filter","$state","$http","$stateParams","util",function(a,b,c,d,e,f){var g=this;g.init=function(){g.loadInfo(),g.defaultLangCode=f.getDefaultLangCode()},g.loadInfo=function(){var a=JSON.stringify({action:"getHotelList",token:f.getParams("token"),lang:f.langStyle()});g.loading=!0,d({method:"POST",url:f.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?g.list=b.data:alert("读取信息失败"+b.errInfo)},function(a){alert("服务器出错")}).finally(function(a){g.loading=!1})},g.delete=function(a){if(confirm("确认删除？")){var b=JSON.stringify({action:"delHotel",token:f.getParams("token"),lang:f.langStyle(),HotelID:a});d({method:"POST",url:f.getApiUrl("hotelroom","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("已删除"),c.reload()):alert("删除失败"+b.errInfo)},function(a){alert("服务器出错")})}},g.edit=function(b){a.app.maskParams={hotelId:b},a.app.showHideMask(!0,"pages/hotelEdit.html")},g.add=function(){a.app.showHideMask(!0,"pages/projectConfig/hotelAdd.html")}}]).controller("hotelAddController",["$scope","$state","$http","$stateParams","$filter","util","CONFIG",function(a,b,c,d,e,f,g){function h(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}console.log("hotelEditController");var i=this;i.init=function(){i.defaultLangCode=f.getDefaultLangCode(),i.ifCheckedHotelTags=[],i.editLangs=f.getParams("editLangs"),i.hotel={},i.imgs1=new h([]),i.imgs2=new h([],!0),i.getHotelTags()},i.cancel=function(){a.app.showHideMask(!1)},i.save=function(){for(var a=[],d=0;d<i.imgs1.data.length;d++)a[d]={},a[d].Seq=d,a[d].ImageURL=i.imgs1.data[d].src,a[d].ImageSize=i.imgs1.data[d].fileSize;for(var e=[],d=0;d<i.ifCheckedHotelTags.length;d++)i.ifCheckedHotelTags[d].checked&&e.push({ID:i.ifCheckedHotelTags[d].ID});i.saving=!0;var g=JSON.stringify({action:"addHotel",token:f.getParams("token"),lang:f.langStyle(),data:{Name:i.hotel.Name,CityName:i.hotel.CityName,LocationX:i.hotel.LocationX?i.hotel.LocationX:0,LocationY:i.hotel.LocationY?i.hotel.LocationY:0,LogoURL:i.imgs2.data.length>0?i.imgs2.data[0].src:"",Features:e,TelePhone:null,AdminPhoneNum:i.hotel.AdminPhoneNum,Address:i.hotel.Address?i.hotel.Address:{},Description:i.hotel.Description?i.hotel.Description:{},OfficePhone:null,Gallery:a,TermMainPage:i.hotel.TermMainPage}});c({method:"POST",url:f.getApiUrl("hotelroom","","server"),data:g}).then(function(a){var c=a.data;"200"==c.rescode?(alert("添加成功"),b.reload()):alert("添加失败"+c.err)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.saving=!1})},i.getHotelTags=function(){i.loading=!0;var a=JSON.stringify({action:"getHotelFeatureTag",token:f.getParams("token"),lang:f.langStyle()});c({method:"POST",url:f.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(i.hotelTags=b.data,i.initIfCheckedHotelTags()):alert("读取酒店标签出错"+b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")}).finally(function(a){i.loading=!1})},i.initIfCheckedHotelTags=function(){for(var a=0;a<i.hotelTags.length;a++)i.ifCheckedHotelTags[a]={},i.ifCheckedHotelTags[a].checked=!1,i.ifCheckedHotelTags[a].ID=i.hotelTags[a].ID},i.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},h.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var d=1;d<this.data.length;d++)this.deleteById(this.data[d].id);var e=a[b],h=g.uploadUrl,i=new XMLHttpRequest,j=this.add(i,e.name,e.size,i);f.uploadFileToUrl(i,e,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1&&c.deleteById(c.data[0].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console.log("failure"),b.abort()})}}}]).controller("pcProjectInfoController",["$scope","$state","$http","CONFIG","util",function(a,b,c,d,e){function f(a,b){this.initImgList=a,this.data=[],this.maxId=0,this.single=!!b}var g=this;g.init=function(){g.editLangs=e.getParams("editLangs"),g.loadInfo()},g.loadInfo=function(){var a=JSON.stringify({action:"getTotalInfo",token:e.getParams("token"),lang:e.langStyle()});g.loading=!0,c({method:"POST",url:e.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(g.projectName=JSON.parse(b.data.projectName),g.LogoImg=b.data.ProjectLogo,g.imgs1=new f([{ImageURL:g.LogoImg,ImageSize:0}],!0),g.imgs1.initImgs()):alert("读取信息失败"+b.errInfo)},function(a){alert("服务器出错")}).finally(function(a){g.loading=!1})},g.save=function(){for(var a=[],d=0;d<g.imgs1.data.length;d++)a[d]={},a[d].Seq=d,a[d].ImageURL=g.imgs1.data[d].src,a[d].ImageSize=g.imgs1.data[d].fileSize;if(0==a.length)return void alert("请上传LOGO");g.saving=!0;var f=JSON.stringify({action:"setTotalInfo",token:e.getParams("token"),lang:e.langStyle(),data:{projectName:g.projectName,ProjectLogo:g.imgs1.data[0].src}});c({method:"POST",url:e.getApiUrl("hotelroom","","server"),data:f}).then(function(a){var c=a.data;"200"==c.rescode?(alert("保存成功"),b.reload()):alert("保存失败"+c.errInfo)},function(a){alert("服务器出错")}).finally(function(a){g.saving=!1})},g.clickUpload=function(a){setTimeout(function(){document.getElementById(a).click()},0)},f.prototype={initImgs:function(){for(var a=this.initImgList,b=0;b<a.length;b++)this.data[b]={src:a[b].ImageURL,fileSize:a[b].ImageSize,id:this.maxId++,progress:100}},deleteById:function(a){for(var b=this.data,c=0;c<b.length;c++)if(b[c].id==a){b[c].progress<100&&b[c].progress!=-1&&b[c].xhr.abort(),b.splice(c,1);break}},add:function(a,b,c){return this.data.push({xhr:a,fileName:b,fileSize:c,progress:0,id:this.maxId}),this.maxId++},update:function(a,b,c,d){for(var e=0;e<this.data.length;e++){var f=this.data[e];if(f.id===a){f.progress=b,f.leftSize=c,f.fileSize=d;break}}},setSrcSizeByXhr:function(a,b,c){for(var d=0;d<this.data.length;d++)if(this.data[d].xhr==a){this.data[d].src=b,this.data[d].fileSize=c;break}},uploadFile:function(b,c){if(this.single)for(var f=1;f<this.data.length;f++)this.deleteById(this.data[f].id);var g=a[b],h=d.uploadUrl,i=new XMLHttpRequest,j=this.add(i,g.name,g.size,i);e.uploadFileToUrl(i,g,h,"normal",function(b){a.$apply(function(){if(b.lengthComputable){var a=Math.round(100*b.loaded/b.total);c.update(j,a,b.total-b.loaded,b.total),console&&console.log(a)}})},function(b){var d=JSON.parse(b.responseText);console&&console.log(d),a.$apply(function(){if(c.setSrcSizeByXhr(b,d.upload_path,d.size),c.single&&c.data.length>1)for(var a=0;a<c.data.length-1;a++)c.deleteById(c.data[a].id)})},function(b){a.$apply(function(){c.update(j,-1,"","")}),console&&console.log("failure"),b.abort()})}}}])}(),function(){angular.module("app.orders-controllers",[]).controller("hotelOrderListController",["$scope","$filter","$q","$state","$http","$stateParams","NgTableParams","util",function(a,b,c,d,e,f,g,h){var i=this;i.init=function(){i.defaultLangCode=h.getDefaultLangCode(),i.searchStr={},a.status=[{code:"",active:!0,name:{"zh-CN":"全部"}},{code:"WAITPAY",active:!1,name:{"zh-CN":"待付款"}},{code:"WAITAPPROVAL",active:!1,name:{"zh-CN":"待审核"}},{code:"ACCEPT",active:!1,name:{"zh-CN":"待入住"}},{code:"COMPLETED",active:!1,name:{"zh-CN":"订单完成"}},{code:"REFUNDING",active:!1,name:{"zh-CN":"退款中"}},{code:"CANCELED",active:!1,name:{"zh-CN":"已取消"}}],i.searchStr.status="",i.loadShopList().then(function(){i.search()})},i.getSelectedHotel=function(){var b={};if(a.shopList)for(var c=0;c<a.shopList.length;c++)if(a.shopList[c].active){b=a.shopList[c];break}return b},i.accept=function(a){var b=JSON.stringify({token:h.getParams("token"),action:"OrderApproval",lang:h.langStyle(),OrderID:a,status:"ACCEPT"});e({method:"POST",url:h.getApiUrl("order","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("审核成功"),i.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("审核失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){}),alert("命令已发送，请稍后")},i.reject=function(a){var b=JSON.stringify({token:h.getParams("token"),action:"OrderApproval",lang:h.langStyle(),OrderID:a,status:"DECLINE"});e({method:"POST",url:h.getApiUrl("order","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("审核成功"),i.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("审核失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){}),alert("命令已发送，请稍后")},i.finish=function(a){var b=JSON.stringify({token:h.getParams("token"),action:"orderCompleted",lang:h.langStyle(),OrderID:a});e({method:"POST",url:h.getApiUrl("order","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("操作已成功"),i.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("操作失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){})},i.cancel=function(a){var b=JSON.stringify({token:h.getParams("token"),action:"adminCancelOrder",lang:h.langStyle(),OrderID:a});e({method:"POST",url:h.getApiUrl("order","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("操作已成功"),i.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("操作失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){})},i.searchByStatus=function(b){for(var c=0;c<a.status.length;c++)a.status[c].code==b?(a.status[c].active=!0,i.searchStr.status=b):a.status[c].active=!1;i.search()},i.searchByShop=function(b){for(var c=0;c<a.shopList.length;c++)a.shopList[c].ID==b?(a.shopList[c].active=!0,i.searchStr.shopId=b):a.shopList[c].active=!1;i.search()},i.loadShopList=function(){var b=c.defer(),f=JSON.stringify({token:h.getParams("token"),action:"getHotelList",lang:h.langStyle()});return i.loadingShopList=!0,e({method:"POST",url:h.getApiUrl("hotelroom","","server"),data:f}).then(function(c){var e=c.data;if("200"==e.rescode){a.shopList=e.data;for(var f={"zh-CN":"全部","en-US":"All"},g=0;g<a.shopList.length;g++)a.shopList[g].active=!1;a.shopList.unshift({ID:0,Name:f,active:!0}),i.searchStr.shopId=0,b.resolve()}else"401"==e.rescode?(alert("访问超时，请重新登录"),d.go("login")):(alert("获取门店列表信息失败，"+e.errInfo),b.reject())},function(a){alert("连接服务器出错"),b.reject()}).finally(function(a){i.loadingShopList=!1}),b.promise},i.search=function(){i.tableParams=new g({page:1,count:15,url:""},{counts:!1,getData:function(a){var b=a.url(),c=JSON.stringify({token:h.getParams("token"),action:"getRoomOrderByStatus",lang:h.langStyle(),HotelID:i.searchStr.shopId,ContactorPhone:i.searchStr.userPhone,Status:i.searchStr.status,ContactorName:i.searchStr.userName,OrderNum:i.searchStr.orderNumber,page:b.page-0,per_page:b.count-0});return i.loading=!0,i.noData=!1,e({method:"POST",url:h.getApiUrl("order","","server"),data:c}).then(function(b){var c=b.data;return"200"==c.rescode?(0==c.total&&(i.noData=!0),a.total(c.total),c.resault):void("401"==c.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("获取客房预订订单列表失败，"+c.errInfo))},function(a){alert("连接服务器出错")}).finally(function(a){i.loading=!1})}})},i.gotoDetail=function(b){a.app.maskParams={orderInfo:b},a.app.showHideMask(!0,"pages/orders/hotelOrderDetail.html")}}]).controller("hotelOrderDetailController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.orderInfo=a.app.maskParams.orderInfo,h.defaultLangCode=f.getDefaultLangCode(),h.id=h.orderInfo.OrderID,h.getInfo()},h.close=function(){a.app.showHideMask(!1)},h.getInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getOperateLog",lang:f.langStyle(),OrderID:h.id});h.loading=!0,c({method:"POST",url:f.getApiUrl("order","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?h.list=c.operatelogs:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("获取信息失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.loading=!1})}}]).controller("shopOrderListController",["$scope","$filter","$q","$state","$http","$stateParams","$location","NgTableParams","util","CONFIG",function(a,b,c,d,e,f,g,h,i,j){var k=this,k=this;k.init=function(){k.defaultLangCode=i.getDefaultLangCode(),k.searchStr={},a.status=[{code:"",active:!0,name:{"zh-CN":"全部"}},{code:"WAITPAY",active:!1,name:{"zh-CN":"待付款"}},{code:"WAITAPPROVAL",active:!1,name:{"zh-CN":"待审核"}},{code:"ACCEPT",active:!1,name:{"zh-CN":"待发货"}},{code:"DELIVERING",active:!1,name:{"zh-CN":"待收货"}},{code:"COMPLETED",active:!1,name:{"zh-CN":"订单完成"}},{code:"REFUNDING",active:!1,name:{"zh-CN":"退款中"}},{code:"CANCELED",active:!1,name:{"zh-CN":"已取消"}}],k.searchStr.status="",k.loadShopList().then(function(){k.search()})},k.getSelectedShop=function(){var b={};if(a.shopList)for(var c=0;c<a.shopList.length;c++)if(a.shopList[c].active){b=a.shopList[c];break}return b},k.deliver=function(b){a.app.maskParams={orderId:b,search:k.search},a.app.showHideMask(!0,"pages/orders/shopOrderDeliver.html")},k.editDeliverInfo=function(b){a.app.maskParams={orderInfo:b,search:k.search},a.app.showHideMask(!0,"pages/orders/editShopOrderDeliver.html")},k.accept=function(a){var b=JSON.stringify({token:i.getParams("token"),action:"OrderApproval",lang:i.langStyle(),OrderID:a,status:"ACCEPT"});e({method:"POST",url:i.getApiUrl("shoporder","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("审核成功"),k.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("审核失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){}),alert("命令已发送，请稍后")},k.reject=function(a){var b=JSON.stringify({token:i.getParams("token"),action:"OrderApproval",lang:i.langStyle(),OrderID:a,status:"DECLINE"});e({method:"POST",url:i.getApiUrl("shoporder","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("审核成功"),k.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("审核失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){}),alert("命令已发送，请稍后")},k.finish=function(a){var b=JSON.stringify({token:i.getParams("token"),action:"orderCompleted",lang:i.langStyle(),OrderID:a});e({method:"POST",url:i.getApiUrl("shoporder","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("操作已成功"),k.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("操作失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){})},k.cancel=function(a){var b=JSON.stringify({token:i.getParams("token"),action:"adminCancelOrder",lang:i.langStyle(),OrderID:a});e({method:"POST",url:i.getApiUrl("shoporder","","server"),data:b}).then(function(a){var b=a.data;"200"==b.rescode?(alert("操作已成功"),k.search()):"401"==b.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("操作失败"+b.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){})},k.searchByStatus=function(b){for(var c=0;c<a.status.length;c++)a.status[c].code==b?(a.status[c].active=!0,k.searchStr.status=b):a.status[c].active=!1;k.search()},k.searchByShop=function(b){for(var c=0;c<a.shopList.length;c++)a.shopList[c].ShopID==b?(a.shopList[c].active=!0,k.searchStr.shopId=b):a.shopList[c].active=!1;k.search()},k.loadShopList=function(){var b=c.defer(),f=JSON.stringify({token:i.getParams("token"),action:"getMgtHotelShopInfo",lang:i.langStyle()});return k.loadingShopList=!0,e({method:"POST",url:i.getApiUrl("shopinfo","","server"),data:f}).then(function(c){var e=c.data;if("200"==e.rescode){a.shopList=e.data.shopList;for(var f=0;f<a.shopList.length;f++)a.shopList[f].active=!1;a.shopList.unshift({ShopID:0,HotelID:0,ShopName:{"zh-CN":"全部"},HotelName:{"zh-CN":""},ShopType:"wx",active:!0}),k.searchStr.shopId=0,b.resolve()}else"401"==e.rescode?(alert("访问超时，请重新登录"),d.go("login")):(alert("获取商城列表信息失败，"+e.errInfo),b.reject())},function(a){alert("连接服务器出错"),b.reject()}).finally(function(a){k.loadingShopList=!1}),b.promise},k.search=function(){k.tableParams=new h({page:1,count:15,url:""},{counts:!1,getData:function(a){var b=a.url(),c=JSON.stringify({token:i.getParams("token"),action:"getOrderByStatus",lang:i.langStyle(),ShopID:k.searchStr.shopId,ContactorPhone:k.searchStr.userPhone,Status:k.searchStr.status,ContactorName:k.searchStr.userName,OrderNum:k.searchStr.orderNumber,page:b.page-0,per_page:b.count-0});return k.loading=!0,k.noData=!1,e({method:"POST",url:i.getApiUrl("shoporder","","server"),data:c}).then(function(b){var c=b.data;return"200"==c.rescode?(0==c.total&&(k.noData=!0),a.total(c.total),c.resault):void("401"==c.rescode?(alert("访问超时，请重新登录"),d.go("login")):alert("获取商城订单列表失败，"+c.errInfo))},function(a){alert("连接服务器出错")}).finally(function(a){k.loading=!1})}})},k.gotoDetail=function(b){a.app.maskParams={orderId:b.ID,orderInfo:b},a.app.showHideMask(!0,"pages/orders/shopOrderDetail.html")}}]).controller("shopOrderDetailController",["$scope","$state","$http","$stateParams","$location","util","CONFIG",function(a,b,c,d,e,f,g){var h=this;h.init=function(){h.id=a.app.maskParams.orderId,h.deliverInfo=a.app.maskParams.orderInfo,h.getInfo()},h.getInfo=function(){var a=JSON.stringify({token:f.getParams("token"),action:"getOrderDetailByID",lang:f.langStyle(),OrderID:h.id});h.loading=!0,c({method:"POST",url:f.getApiUrl("shoporder","","server"),data:a}).then(function(a){var c=a.data;"200"==c.rescode?h.info=c.data:"401"==c.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("获取信息失败"+c.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){h.loading=!1})},h.close=function(){a.app.showHideMask(!1)}}]).controller("shopOrderDeliverController",["$scope","$state","$http","util",function(a,b,c,d){var e=this;e.init=function(){e.id=a.app.maskParams.orderId},e.close=function(){a.app.showHideMask(!1)},e.submit=function(){var f=JSON.stringify({token:d.getParams("token"),action:"setExpressInfo",lang:d.langStyle(),OrderID:e.id,ExpressNum:e.ExpressNum,ExpressCompany:e.ExpressCompany});e.saving=!0,c({method:"POST",url:d.getApiUrl("shoporder","","server"),data:f}).then(function(c){var d=c.data;"200"==d.rescode?(alert("发货成功"),a.app.maskParams.search(),e.close()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("发货失败"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){e.saving=!1})},e.close=function(){a.app.showHideMask(!1)}}]).controller("editShopOrderDeliverController",["$scope","$state","$http","util",function(a,b,c,d){var e=this;e.init=function(){e.info=a.app.maskParams.orderInfo,e.id=e.info.ID,e.ExpressNum=e.info.ExpressNum,e.ExpressCompany=e.info.ExpressCompany},e.close=function(){a.app.showHideMask(!1)},e.submit=function(){var f=JSON.stringify({token:d.getParams("token"),action:"updateExpressInfo",lang:d.langStyle(),OrderID:e.id,ExpressNum:e.ExpressNum,ExpressCompany:e.ExpressCompany});e.saving=!0,c({method:"POST",url:d.getApiUrl("shoporder","","server"),data:f}).then(function(c){var d=c.data;"200"==d.rescode?(alert("修改成功"),a.app.maskParams.search(),e.close()):"401"==d.rescode?(alert("访问超时，请重新登录"),b.go("login")):alert("发货失败"+d.errInfo)},function(a){alert("连接服务器出错")}).finally(function(a){e.saving=!1})},e.close=function(){a.app.showHideMask(!1)}}])}(),function(){angular.module("app.directives",[]).directive("fileModel",["$parse","CONFIG",function(a,b){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b.$parent,c[0].files[0])}),document.getElementById(d.e).click()})}}}])}(),function(){angular.module("app.services",[]).factory("util",["$cookies","$translate","CONFIG",function(a,b,c){return{getApiUrl:function(a,b,d){return d?"server"==d?c.serverUrl+a:c.testUrl+b:c.test?c.testUrl+b:c.serverUrl+a},getUploadUrl:function(){return c.uploadUrl},setParams:function(b,c){a.put(b,JSON.stringify(c))},getParams:function(b){return!!a.get(b)&&JSON.parse(a.get(b))},langStyle:function(){return b.proposedLanguage()||b.use()},getDefaultLangCode:function(){for(var b=JSON.parse(a.get("editLangs")),c=0;c<b.length;c++)if(b[c].default)return b[c].code},uploadFileToUrl:function(a,b,c,d,e,f,g){var d=d?d:"normal",h=new FormData;h.append("action",d),h.append("file",b),a.open("POST",c,!0),a.upload.addEventListener("progress",function(a){e(a)},!1),a.onreadystatechange=function(b){4==a.readyState&&200==a.status&&""!=a.responseText?(console.log(a.responseText),0!==JSON.parse(a.responseText).result?g(a):f(a)):200!=a.status&&a.responseText&&g(a)},a.send(h)},getToday:function(){var a=new Date,b="-",c=a.getMonth()+1,d=a.getDate();c>=1&&c<=9&&(c="0"+c),d>=0&&d<=9&&(d="0"+d);var e=a.getFullYear()+b+c+b+d;return e},getTomorrow:function(){var a=new Date,b="-",c=a.getMonth()+1,d=a.getDate()+1;c>=1&&c<=9&&(c="0"+c),d>=0&&d<=9&&(d="0"+d);var e=a.getFullYear()+b+c+b+d;return e},format_yyyyMMdd:function(a){var b="-",c=a.getMonth()+1,d=a.getDate();c>=1&&c<=9&&(c="0"+c),d>=0&&d<=9&&(d="0"+d);var e=a.getFullYear()+b+c+b+d;return e}}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}]).filter("fenToYuan",function(){return function(a){var b=a+"";1==b.length?b="00"+b:2==b.length&&(b="0"+b);var c=b.slice(0,-2),d=b.slice(-2);return c+"."+d}}).filter("orderStatus",["$filter",function(a){return function(b){var c;switch(b){case"WAITPAY":c=a("translate")("WAITPAY");break;case"WAITAPPROVAL":c=a("translate")("WAITAPPROVAL");break;case"ACCEPT":c=a("translate")("ACCEPT");break;case"COMPLETED":c=a("translate")("COMPLETED");break;case"REFUNDING":c=a("translate")("REFUNDING");break;case"CANCELED":c=a("translate")("CANCELED")}return c}}]).filter("shopOrderStatus",["$filter",function(a){return function(a){var b;switch(a){case"WAITPAY":b="待付款";break;case"WAITAPPROVAL":b="待审核";break;case"ACCEPT":b="待发货";break;case"DELIVERING":b="待收货";break;case"COMPLETED":b="订单完成";break;case"REFUNDING":b="退款中";break;case"CANCELED":b="已取消"}return b}}]).filter("operateAction",["$filter",function(a){return function(a){var b;switch(a){case"GUEST_CANCEL":b="用户取消订单";break;case"ADMIN_CANCEL":b="管理员取消订单";break;case"CANCEL_REFUNDING":b="用户取消退款中";break;case"SELLER_CANCEL_REFUNDING":b="管理员取消退款中";break;case"ACCEPT":b="订单审核通过";break;case"COMPLETED":b="订单完成";break;case"SELLER_DECLINE":b="订单审核不通过";break;case"CHANGE_EXPRESS":b="更新了快递信息"}return b}}]).filter("deliverWay",["$filter",function(a){return function(a){var b;switch(a){case"express":b="快递";break;case"bySelf":b="自提"}return b}}])}();