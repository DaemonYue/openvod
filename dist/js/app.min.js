/*! openvod | emma | ISC */
"use strict";!function(){angular.module("openvod",["ui.router","pascalprecht.translate","app.controllers","app.filters","app.directives","app.services","angular-md5","ngCookies","ngTable"]).config(["$translateProvider",function(a){var b=navigator.language.indexOf("zh")>-1?"zh-CN":"en-US";a.preferredLanguage(b),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/login"),a.state("login",{url:"/login",templateUrl:"pages/login.html"}).state("app",{url:"/app?appId",templateUrl:"pages/app.html"}).state("app.shop",{url:"/shop",templateUrl:"pages/shop.html"}).state("app.shop.goods",{url:"/goods?HotelID&ShopID&ShopName&HotelName",templateUrl:"pages/goods.html"}).state("app.shop.goods.goodsList",{url:"/goodsList?ShopGoodsCategoryID&ShopGoodsCategoryName",templateUrl:"pages/goodsList.html"}).state("app.hotelRoom",{url:"/hotelRoom",templateUrl:"pages/hotelRoom.html"}).state("app.hotelRoom.room",{url:"/room?hotelId",templateUrl:"pages/room.html"})}]).run(["$rootScope","util",function(a,b){a.$on("$stateChangeStart",function(a,c,d,e,f,g){b.getParams("token")||"login"==c.name||(alert("访问超时，请重新登录"),window.location.href=window.location.origin+window.location.pathname)})}]).constant("CONFIG",{serverUrl:"http://openvod.cleartv.cn/backend_mgt/v1/",testUrl:"test/",test:!1})}(),function(){angular.module("app.controllers",[]).controller("indexController",["$scope",function(a){var b=this;b.init=function(){this.maskUrl=""}}]).controller("loginController",["$scope","$http","$filter","$state","md5","util",function(a,b,c,d,e,f){var g=this;g.init=function(){},g.login=function(){g.loading=!0;var a=JSON.stringify({action:"GetToken",projectName:g.projectName,username:g.userName,password:e.createHash(g.password)});b({method:"POST",url:f.getApiUrl("logon","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.setParams("userName",g.userName),f.setParams("projectName",g.projectName),f.setParams("token",b.token),g.getEditLangs()):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")})},g.getEditLangs=function(){b({method:"GET",url:f.getApiUrl("","editLangs.json","local")}).then(function(a){f.setParams("editLangs",a.data.editLangs),d.go("app")},function(a){})}}]).controller("appController",["$http","$scope","$state","$stateParams","util",function(a,b,c,d,e){var f=this;f.init=function(){"app"!==c.current.name?f.appPhase=2:f.appPhase=1,f.appFramePhase=1,f.maskUrl="",f.maskParams={},f.loading=!0,a({method:"GET",url:e.getApiUrl("","apps.json","local")}).then(function(a,c,e,g){b.appList=a.data.apps,d.appId&&f.setFocusApp(d.appId)},function(a,b,c,d){}).finally(function(a){f.loading=!1}),console.log(e.getParams("editLangs"))},f.setFocusApp=function(a){for(var c=b.appList,d=0;d<c.length;d++)if(c[d].id==a)return f.activeAppName=c[d].name,void(f.activeAppBgColor=c[d].bgColor)},f.switchApp=function(a){switch(f.appPhase=2,f.setFocusApp(a),a){case 1:c.go("app.hotelRoom",{appId:a});break;case 3:c.go("app.shop",{appId:a})}},f.showDesktop=function(){f.appPhase=1,setTimeout(function(){f.appFramePhase=1},530)},f.focusLauncher=function(){f.appFramePhase=2},f.focusApp=function(){f.appFramePhase=1},f.logout=function(a){e.setParams("token",""),c.go("login")}}]).controller("shopController",["$scope","$state","$translate","$http","$stateParams","$filter","util",function(a,b,c,d,e,f,g){console.log("shopController");var h=this;h.init=function(){h.langStyle=g.langStyle(),h.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],console.log(h.langStyle),console.log(h.multiLang),h.searchShopList()},h.searchShopList=function(){var a={action:"getMgtHotelShopInfo",token:g.getParams("token"),lang:h.langStyle};a=JSON.stringify(a),d({method:f("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){console.log(a),h.shopList=a.data.data.shopList,h.shopFirst=h.shopList[0],b.go("app.shop.goods",{ShopID:h.shopFirst.ShopID,HotelID:h.shopFirst.HotelID,ShopName:h.shopFirst.ShopName[h.langStyle],HotelName:h.shopFirst.HotelName[h.langStyle]})},function(a,b,c,d){})},h.shopAdd=function(){a.app.maskParams={test:"12"},a.app.maskUrl="pages/shopAdd.html"}}]).controller("shopAddController",["$scope","$state","$http","$stateParams","$translate","$filter","util",function(a,b,c,d,e,f,g){console.log("shopAddController");var h=this;h.init=function(){h.langStyle=g.langStyle(),h.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],console.log(h.langStyle),h.searchHotelList(),h.form={},h.form.shopName={}},h.cancel=function(){console.log("cancel"),a.app.maskUrl=""},h.searchHotelList=function(){var a={action:"getMgtHotelInfo",token:g.getParams("token"),lang:h.langStyle};a=JSON.stringify(a),c({method:f("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,b,c,d){console.log(a),h.hotelList=a.data.data.hotelList},function(a,b,c,d){})},h.saveForm=function(){console.log(h.form.HotelID);var a={HotelID:h.form.HotelID-0,ShopName:h.form.shopName,ShopType:"wx"},d={action:"addMgtHotelShop",token:g.getParams("token"),lang:h.langStyle,shopList:[a]};d=JSON.stringify(d),c({method:f("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){alert("添加成功"),b.reload()},function(a,b,c,d){})}}]).controller("goodsController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("goodsController"),console.log(d);var g=this;g.init=function(){g.stateParams=d,g.langStyle=f.langStyle(),g.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],g.getGoodsCategory()},g.goodsAdd=function(){a.app.maskParams={shopId:"1",shopGoodsCategoryId:"1"},a.app.maskUrl="pages/goodsAdd.html"},g.categoryAdd=function(){console.log("categoryAdd"),a.app.maskParams={ShopID:g.stateParams.ShopID-0},a.app.maskUrl="pages/categoryAdd.html"},g.shopEdit=function(){console.log("shopEdit"),a.app.maskParams={ShopID:d.ShopID,ShopName:d.ShopName,HotelID:d.HotelID},a.app.maskUrl="pages/shopEdit.html"},g.getGoodsCategory=function(){var a={action:"getMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,shopId:d.ShopID};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){console.log(a),g.categoryList=a.data.data.categoryList,b.go("app.shop.goods.goodsList",{ShopGoodsCategoryID:"all",ShopGoodsCategoryName:"全部商品"})},function(a,b,c,d){})}}]).controller("goodsAddController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("goodsAddController");var g=this;g.init=function(){console.log(a.app.maskParams.test)},g.cancel=function(){console.log("cancel"),a.app.maskUrl=""}}]).controller("goodsEditController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("goodsEditController");var g=this;g.init=function(){console.log(a.app.maskParams.test)},g.cancel=function(){console.log("goodsEditcancel"),a.app.maskUrl=""}}]).controller("shopEditController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("shopEditController"),console.log("$stateParams: "+d);var g=this;g.init=function(){g.maskParams=a.app.maskParams,console.log(g.maskParams),g.langStyle=f.langStyle(),g.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],g.form={},g.form.shopName={},g.searchHotelList()},g.cancel=function(){console.log("cancel"),a.app.maskUrl=""},g.searchHotelList=function(){var a={action:"getMgtHotelInfo",token:f.getParams("token"),lang:g.langStyle};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,b,c,d){console.log(a),g.hotelList=[{HotelID:1,HotelName:{"zh-CN":"上海门店"}},{HotelID:2,HotelName:{"zh-CN":"北京门店"}}]},function(a,b,c,d){})},g.saveForm=function(){console.log(g.form.HotelID);var a={HotelID:g.form.HotelID-0,ShopName:g.form.shopName,ShopType:"wx"},d={action:"addMgtHotelShop",token:f.getParams("token"),lang:g.langStyle,shopList:[a]};d=JSON.stringify(d),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){alert("修改成功"),b.reload()},function(a,b,c,d){})},g.deleteShop=function(){var a=confirm("确认删除？");if(a){var d=({HotelID:g.form.HotelID-0,ShopName:g.form.shopName,ShopType:"wx"},{action:"deleteMgtHotelShop",token:f.getParams("token"),lang:g.langStyle,shop:{ShopID:g.maskParams.ShopID-0}});d=JSON.stringify(d),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){alert("删除成功"),b.reload()},function(a,b,c,d){})}}}]).controller("categoryAddController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("categoryAddController"),console.log(d);var g=this;g.init=function(){g.langStyle=f.langStyle(),g.maskParams=a.app.maskParams,console.log(g.maskParams),g.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],g.form={},g.form.shopName={}},g.cancel=function(){console.log("cancel"),a.app.maskUrl=""},g.saveForm=function(){var a={action:"addMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,ShopGoodsCategory:{ShopGoodsCategoryName:g.form.shopName,ShopID:g.maskParams.ShopID-0}};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){alert("分类添加成功"),b.reload()},function(a,b,c,d){})}}]).controller("categoryEditController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){console.log("categoryEditController"),console.log(d),console.log(a.app.maskParams);var g=this;g.init=function(){g.stateParams=d,g.maskParams=a.app.maskParams,g.langStyle=f.langStyle(),g.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],g.form={},g.form.shopName={}},g.cancel=function(){console.log("cancel"),a.app.maskUrl=""},g.saveForm=function(){console.log(g.form.HotelID),console.log(g.form.HotelID);var a={action:"editMgtProductCategory",token:f.getParams("token"),lang:g.langStyle,ShopGoodsCategory:{ShopGoodsCategoryID:g.maskParams.ShopGoodsCategoryID,ShopGoodsCategoryName:g.form.shopName}};a=JSON.stringify(a),c({method:e("ajaxMethod")(),url:f.getApiUrl("shopinfo","shopList","server"),data:a}).then(function(a,c,d,e){alert("分类修改成功"),b.reload()},function(a,b,c,d){})}}]).controller("goodsListController",["$scope","$state","$http","$stateParams","$filter","NgTableParams","util",function(a,b,c,d,e,f,g){console.log("goodsListController"),console.log(d),console.log(a.app.maskParams);var h=this;h.init=function(){h.stateParams=d,h.langStyle=g.langStyle(),h.multiLang=[{name:"中文",code:"zh-CN"},{name:"en",code:"en-US"}],h.form={},h.form.shopName={},h.getProductList(h.stateParams.ShopGoodsCategoryID)},h.categoryEdit=function(){a.app.maskParams={ShopGoodsCategoryID:h.stateParams.ShopGoodsCategoryID-0},a.app.maskUrl="pages/categoryEdit.html"},h.categoryDelete=function(){var a=confirm("确认删除？");if(a){var d={action:"deleteMgtProductCategory",token:g.getParams("token"),lang:h.langStyle,ShopGoodsCategoryID:h.stateParams.ShopGoodsCategoryID-0};d=JSON.stringify(d),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:d}).then(function(a,c,d,e){alert("分类删除成功"),b.reload()},function(a,b,c,d){})}},h.goodsEdit=function(){a.app.maskParams={test:"12"},a.app.maskUrl="pages/goodsEdit.html"},h.getProductList=function(a){var b={action:"getMgtShopProductList",token:g.getParams("token"),lang:h.langStyle,ShopID:h.stateParams.ShopID-0};"all"!=a&&(b.ShopGoodsCategoryID=h.stateParams.ShopGoodsCategoryID-0),h.tableParams=new f({page:1,count:3},{counts:[3,6],getData:function(a){var d=a.url();b.count=d.count,b.page=d.page,b=JSON.stringify(b),c({method:e("ajaxMethod")(),url:g.getApiUrl("shopinfo","shopList","server"),data:b}).then(function(a,b,c,d){console.log(a),h.productList=a.data.data.productList},function(a,b,c,d){})}})}}]).controller("hotelRoomController",["$scope",function(a){var b=this;b.init=function(){b.queryHotelList()},b.queryHotelList=function(){var a=[];a=[{hotelId:1,hotelName:"testhotel1"},{hotelId:2,hotelName:"testhotel2"},{hotelId:3,hotelName:"testhotel3"}],b.hotels=a}}]).controller("roomController",["$scope","$http","$stateParams","$translate","util",function(a,b,c,d,e){var f=this,g=d.proposedLanguage()||d.use();console.log(g),f.init=function(){f.hotelId=c.hotelId,f.getHotelInfo(),f.getRoomList()},f.getHotelInfo=function(){var a=JSON.stringify({action:"getHotel",token:e.getParams("token"),lang:g,HotelID:Number(f.hotelId)});b({method:"POST",url:e.getApiUrl("hotelroom","","server"),data:a}).then(function(a){var b=a.data;"200"==b.rescode?(f.hotelName=b.data.Name,f.hotelAddress=b.data.Address,f.hotelDescription=b.data.Description):alert(b.rescode+" "+b.errInfo)},function(a){alert(a.status+" 服务器出错")})},f.getRoomList=function(){var a=[],c=JSON.stringify({action:"getRoomList",token:e.getParams("token"),lang:g,HotelID:Number(f.hotelId)});b({method:"POST",url:e.getApiUrl("hotelroom","","server"),data:c}).then(function(b){var c=b.data;"200"==c.rescode?(c.data.forEach(function(b){a.push({imgURL:b.LogoImgURL,roomTypeName:b.RoomTypeName})}),f.rooms=a):alert(c.rescode+" "+c.errInfo)},function(a){alert(a.status+" 服务器出错")})},f.roomAdd=function(){a.app.maskParams={hotelId:f.hotelId},a.app.maskUrl="pages/shopAdd.html"}}]).controller("roomAddController",["$scope","$state","$http","$stateParams","$filter","util",function(a,b,c,d,e,f){var g,h=this;h.init=function(){g=a.app.maskParams.hotelId},h.cancel=function(){console.log("cancel"),a.app.maskUrl=""}}])}(),function(){angular.module("app.directives",[])}(),function(){angular.module("app.services",[]).factory("util",["$cookies","$translate","CONFIG",function(a,b,c){return{getApiUrl:function(a,b,d){return d?"server"==d?c.serverUrl+a:c.testUrl+b:c.test?c.testUrl+b:c.serverUrl+a},setParams:function(b,c){a.put(b,JSON.stringify(c))},getParams:function(b){return JSON.parse(a.get(b))},langStyle:function(){return b.proposedLanguage()||b.use()}}}])}(),function(){angular.module("app.filters",[]).filter("ajaxMethod",["CONFIG",function(a){return function(){var b=a.test?"GET":"POST";return b}}])}();